[{"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\index.js":"1","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\App.js":"2","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\contexts\\AuthContext.js":"3","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\Register.js":"4","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\Profile.js":"5","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\Login.js":"6","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\Dashboard.js":"7","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\Shares.js":"8","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\components\\Sidebar.js":"9","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\Files.js":"10","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\components\\Header.js":"11","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\services\\api.js":"12","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\utils\\format.js":"13","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\ShareView.js":"14","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\components\\ShareModal.js":"15","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\components\\FolderSelector.js":"16","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\FileSearch.js":"17"},{"size":862,"mtime":1764225917797,"results":"18","hashOfConfig":"19"},{"size":2180,"mtime":1764300702634,"results":"20","hashOfConfig":"19"},{"size":4429,"mtime":1764429736924,"results":"21","hashOfConfig":"19"},{"size":4970,"mtime":1764226088178,"results":"22","hashOfConfig":"19"},{"size":8126,"mtime":1764242631016,"results":"23","hashOfConfig":"19"},{"size":6800,"mtime":1764430084432,"results":"24","hashOfConfig":"19"},{"size":5700,"mtime":1764232088898,"results":"25","hashOfConfig":"19"},{"size":8212,"mtime":1764425298699,"results":"26","hashOfConfig":"19"},{"size":2234,"mtime":1764300705794,"results":"27","hashOfConfig":"19"},{"size":14538,"mtime":1764435399582,"results":"28","hashOfConfig":"19"},{"size":2447,"mtime":1764226008596,"results":"29","hashOfConfig":"19"},{"size":906,"mtime":1764429728809,"results":"30","hashOfConfig":"19"},{"size":2257,"mtime":1764259331887,"results":"31","hashOfConfig":"19"},{"size":11027,"mtime":1764423804953,"results":"32","hashOfConfig":"19"},{"size":5515,"mtime":1764298531994,"results":"33","hashOfConfig":"19"},{"size":2993,"mtime":1764299015881,"results":"34","hashOfConfig":"19"},{"size":15056,"mtime":1764300311603,"results":"35","hashOfConfig":"19"},{"filePath":"36","messages":"37","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"38"},"1mrtws3",{"filePath":"39","messages":"40","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"38"},{"filePath":"41","messages":"42","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"38"},{"filePath":"43","messages":"44","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"38"},{"filePath":"45","messages":"46","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"38"},{"filePath":"47","messages":"48","errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"49","usedDeprecatedRules":"38"},{"filePath":"50","messages":"51","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"38"},{"filePath":"52","messages":"53","errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"54","usedDeprecatedRules":"38"},{"filePath":"55","messages":"56","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"38"},{"filePath":"57","messages":"58","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"59","messages":"60","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"38"},{"filePath":"61","messages":"62","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"38"},{"filePath":"63","messages":"64","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"38"},{"filePath":"65","messages":"66","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"67","usedDeprecatedRules":"38"},{"filePath":"68","messages":"69","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"70","usedDeprecatedRules":"38"},{"filePath":"71","messages":"72","errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"73","usedDeprecatedRules":"38"},{"filePath":"74","messages":"75","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"76","usedDeprecatedRules":"38"},"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\index.js",[],["77","78"],"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\App.js",[],"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\contexts\\AuthContext.js",[],"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\Register.js",[],"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\Profile.js",[],"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\Login.js",["79","80","81"],"import React, { useState, useEffect } from 'react';\nimport { Form, Input, Button, Card, Typography, message, Spin, Alert } from 'antd';\nimport { UserOutlined, LockOutlined, CloudOutlined, ReloadOutlined } from '@ant-design/icons';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../contexts/AuthContext';\nimport api from '../services/api';\n\nconst { Title, Text } = Typography;\n\nconst Login = () => {\n  const [loading, setLoading] = useState(false);\n  const [apiStatus, setApiStatus] = useState({ checking: true, online: false });\n  const { login } = useAuth();\n  const navigate = useNavigate();\n\n  // 检查API连接状态\n  useEffect(() => {\n    const checkApiStatus = async () => {\n      try {\n        const response = await api.get('/api/auth/', { timeout: 5000 });\n        setApiStatus({ checking: false, online: true });\n      } catch (error) {\n        setApiStatus({ checking: false, online: false });\n        console.warn('API连接检查失败:', error.message);\n      }\n    };\n\n    checkApiStatus();\n  }, []);\n\n  const onFinish = async (values) => {\n    setLoading(true);\n    \n    try {\n      const result = await login(values);\n      if (result.success) {\n        message.success('登录成功！正在跳转...');\n        setTimeout(() => navigate('/dashboard'), 1000);\n      } else {\n        // 使用 alert 弹窗显示错误，不改变界面\n        const errorMsg = result.error || '登录失败，请稍后重试';\n        alert(errorMsg);\n      }\n    } catch (error) {\n      alert('网络连接异常，请检查网络后重试');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRetryApi = () => {\n    setApiStatus({ checking: true, online: false });\n    setTimeout(() => {\n      checkApiStatus();\n    }, 1000);\n  };\n\n  const checkApiStatus = async () => {\n    try {\n      await api.get('/api/auth/', { timeout: 5000 });\n      setApiStatus({ checking: false, online: true });\n    } catch (error) {\n      setApiStatus({ checking: false, online: false });\n    }\n  };\n\n  return (\n    <div style={{\n      minHeight: '100vh',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      padding: '20px',\n      background: '#f0f2f5',\n      fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif'\n    }}>\n      {/* API状态提示 */}\n      {!apiStatus.checking && !apiStatus.online && (\n        <div style={{\n          position: 'absolute',\n          top: '20px',\n          left: '50%',\n          transform: 'translateX(-50%)',\n          zIndex: 1000,\n          width: '90%',\n          maxWidth: '400px'\n        }}>\n          <Alert\n            message=\"服务连接失败\"\n            description=\"无法连接到服务器，请检查网络连接或稍后重试。\"\n            type=\"error\"\n            showIcon\n            closable={false}\n            action={\n              <Button size=\"small\" onClick={handleRetryApi}>\n                重试\n              </Button>\n            }\n            style={{ borderRadius: '8px' }}\n          />\n        </div>\n      )}\n\n      <Card\n        style={{\n          width: '100%',\n          maxWidth: '360px',\n          padding: '40px 32px',\n          border: '1px solid #d9d9d9',\n          borderRadius: '8px',\n          boxShadow: '0 4px 12px rgba(0, 0, 0, 0.08)'\n        }}\n        bodyStyle={{ padding: 0 }}\n      >\n        <div style={{ textAlign: 'center', marginBottom: '32px' }}>\n          <div style={{\n            width: '64px',\n            height: '64px',\n            background: '#1890ff',\n            borderRadius: '50%',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: 'white',\n            fontSize: '28px',\n            margin: '0 auto 20px'\n          }}>\n            <CloudOutlined />\n          </div>\n          <Title level={3} style={{ \n            color: '#262626', \n            margin: '0 0 8px 0',\n            fontSize: '24px',\n            fontWeight: 600\n          }}>\n            登录\n          </Title>\n          <Text style={{ \n            color: '#8c8c8c',\n            fontSize: '14px'\n          }}>\n            欢迎使用云存储系统\n          </Text>\n        </div>\n\n\n\n          <Form\n            name=\"login\"\n            onFinish={onFinish}\n            layout=\"vertical\"\n            size=\"large\"\n            style={{ marginTop: '24px' }}\n          >\n            <Form.Item\n              name=\"username\"\n              rules={[{ required: true, message: '请输入用户名' }]}\n              style={{ marginBottom: '16px' }}\n            >\n              <Input\n                prefix={<UserOutlined style={{ color: '#8c8c8c' }} />}\n                placeholder=\"用户名\"\n                style={{\n                  height: '40px',\n                  border: '1px solid #d9d9d9',\n                  borderRadius: '6px'\n                }}\n              />\n            </Form.Item>\n\n            <Form.Item\n              name=\"password\"\n              rules={[{ required: true, message: '请输入密码' }]}\n              style={{ marginBottom: '24px' }}\n            >\n              <Input.Password\n                prefix={<LockOutlined style={{ color: '#8c8c8c' }} />}\n                placeholder=\"密码\"\n                style={{\n                  height: '40px',\n                  border: '1px solid #d9d9d9',\n                  borderRadius: '6px'\n                }}\n              />\n            </Form.Item>\n\n            <Form.Item style={{ marginBottom: '16px' }}>\n              <Button\n                type=\"primary\"\n                htmlType=\"submit\"\n                loading={loading}\n                disabled={!apiStatus.online && !apiStatus.checking}\n                block\n                style={{\n                  height: '40px',\n                  fontSize: '16px',\n                  fontWeight: 500,\n                  backgroundColor: '#1890ff',\n                  borderColor: '#1890ff',\n                  borderRadius: '6px'\n                }}\n              >\n                {loading ? '登录中...' : '登录'}\n              </Button>\n            </Form.Item>\n          </Form>\n\n          <div style={{ \n            textAlign: 'center',\n            borderTop: '1px solid #f0f0f0',\n            paddingTop: '16px',\n            marginTop: '16px'\n          }}>\n            <Text style={{ color: '#8c8c8c', fontSize: '14px' }}>\n              还没有账号？{' '}\n              <Link \n                to=\"/register\" \n                style={{ \n                  color: '#1890ff',\n                  textDecoration: 'none',\n                  fontWeight: 500\n                }}\n              >\n                立即注册\n              </Link>\n            </Text>\n          </div>\n        </Card>\n    </div>\n  );\n};\n\nexport default Login;","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\Dashboard.js",[],"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\Shares.js",["82","83","84","85","86"],"import React, { useState } from 'react';\nimport { \n  Card, \n  Table, \n  Button, \n  Modal, \n  Form, \n  Input, \n  DatePicker, \n  InputNumber,\n  message,\n  Space,\n  Tag,\n  Typography,\n  Popconfirm,\n  Tooltip\n} from 'antd';\nimport { \n  ShareAltOutlined, \n  PlusOutlined, \n  DeleteOutlined,\n  CopyOutlined,\n  EyeOutlined,\n  HistoryOutlined\n} from '@ant-design/icons';\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\nimport dayjs from 'dayjs';\nimport api from '../services/api';\nimport { formatBytes, formatDateTime, getFileIcon } from '../utils/format';\n\nconst { Title, Text } = Typography;\nconst { RangePicker } = DatePicker;\n\nconst Shares = () => {\n  const queryClient = useQueryClient();\n  const [createModalVisible, setCreateModalVisible] = useState(false);\n  const [showDeleted, setShowDeleted] = useState(false);\n  const [shareForm] = Form.useForm();\n\n  const { data: shares = [], isLoading } = useQuery(\n    'my-shares',\n    () => api.get('/api/files/shares/').then(res => res.data),\n    { enabled: !showDeleted }\n  );\n\n  const { data: deletedShares = [], isLoading: isLoadingDeleted } = useQuery(\n    'deleted-shares',\n    () => api.get('/api/files/shares/deleted/').then(res => res.data),\n    { enabled: showDeleted }\n  );\n\n  const createShareMutation = useMutation(\n    (fileId) => api.post(`/api/files/${fileId}/share/`),\n    {\n      onSuccess: () => {\n        message.success('分享创建成功！');\n        setCreateModalVisible(false);\n        shareForm.resetFields();\n        queryClient.invalidateQueries('my-shares');\n      },\n      onError: (error) => {\n        const errorMsg = error.response?.data?.error || '创建失败';\n        message.error(errorMsg);\n      }\n    }\n  );\n\n  const deleteShareMutation = useMutation(\n    (shareId) => api.delete(`/api/files/shares/${shareId}/delete/`),\n    {\n      onSuccess: () => {\n        message.success('分享已取消！');\n        queryClient.invalidateQueries('my-shares');\n      },\n      onError: (error) => {\n        const errorMsg = error.response?.data?.error || '取消失败';\n        message.error(errorMsg);\n      }\n    }\n  );\n\n  const columns = [\n    {\n      title: '文件名',\n      dataIndex: 'file_name',\n      key: 'file_name',\n      render: (text) => (\n        <Tooltip title={text}>\n          <Text ellipsis style={{ maxWidth: '200px' }}>{text}</Text>\n        </Tooltip>\n      ),\n    },\n    {\n      title: '文件大小',\n      dataIndex: 'file_size_display',\n      key: 'file_size_display',\n    },\n    {\n      title: '分享码',\n      dataIndex: 'share_code',\n      key: 'share_code',\n      render: (code, record) => (\n        <Space>\n          <Tag color=\"blue\">{code}</Tag>\n          <Button\n            type=\"text\"\n            size=\"small\"\n            icon={<CopyOutlined />}\n            onClick={() => {\n              navigator.clipboard.writeText(code);\n              message.success('分享码已复制到剪贴板！');\n            }}\n          />\n        </Space>\n      ),\n    },\n    {\n      title: '状态',\n      dataIndex: 'is_active',\n      key: 'is_active',\n      render: (isActive, record) => (\n        <Space direction=\"vertical\" size=\"small\">\n          <Tag color={isActive ? 'green' : 'red'}>\n            {isActive ? '有效' : '无效'}\n          </Tag>\n          {record.is_expired && (\n            <Tag color=\"orange\">已过期</Tag>\n          )}\n        </Space>\n      ),\n    },\n    {\n      title: '下载次数',\n      dataIndex: 'download_count',\n      key: 'download_count',\n      render: (count, record) => (\n        <Text>\n          {count} / {record.max_downloads || '无限制'}\n        </Text>\n      ),\n    },\n    {\n      title: '过期时间',\n      dataIndex: 'expire_at',\n      key: 'expire_at',\n      render: (time) => time ? dayjs(time).format('YYYY-MM-DD HH:mm') : '永不过期',\n    },\n    {\n      title: '创建时间',\n      dataIndex: 'created_at',\n      key: 'created_at',\n      render: (time) => dayjs(time).format('YYYY-MM-DD HH:mm'),\n    },\n    {\n      title: '操作',\n      key: 'actions',\n      render: (_, record) => {\n        const isDeleted = !record.is_active;\n        \n        return (\n          <Space>\n            <Button\n              type=\"text\"\n              size=\"small\"\n              icon={<EyeOutlined />}\n              onClick={() => window.open(`/share/${record.share_code}`, '_blank')}\n              disabled={isDeleted}\n              title={isDeleted ? '分享已删除，无法访问' : '查看分享'}\n            />\n            {!isDeleted && (\n              <Popconfirm\n                title=\"确定取消这个分享吗？\"\n                onConfirm={() => deleteShareMutation.mutate(record.id)}\n                okText=\"确定\"\n                cancelText=\"取消\"\n              >\n                <Button\n                  type=\"text\"\n                  danger\n                  size=\"small\"\n                  icon={<DeleteOutlined />}\n                />\n              </Popconfirm>\n            )}\n            {isDeleted && (\n              <Tag color=\"red\" icon={<DeleteOutlined />}>\n                已删除\n              </Tag>\n            )}\n          </Space>\n        );\n      },\n    },\n  ];\n\n  return (\n    <div>\n      <div style={{ marginBottom: '24px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n        <Title level={2} style={{ color: '#333', margin: 0 }}>\n          {showDeleted ? '已删除的分享' : '我的分享'}\n        </Title>\n        \n        <Space>\n          <Button \n            icon={<HistoryOutlined />}\n            onClick={() => setShowDeleted(!showDeleted)}\n            className={showDeleted ? \"cel-button\" : \"\"}\n            type={showDeleted ? \"primary\" : \"default\"}\n          >\n            {showDeleted ? '返回当前分享' : '查看已删除'}\n          </Button>\n          \n          {!showDeleted && (\n            <Button \n              type=\"primary\" \n              icon={<PlusOutlined />}\n              onClick={() => setCreateModalVisible(true)}\n              className=\"cel-button\"\n            >\n              创建分享\n            </Button>\n          )}\n        </Space>\n      </div>\n\n      <Card className=\"cel-card\">\n        <Table\n          columns={columns}\n          dataSource={showDeleted ? deletedShares : shares}\n          rowKey=\"id\"\n          loading={showDeleted ? isLoadingDeleted : isLoading}\n          pagination={{\n            pageSize: 10,\n            showSizeChanger: false,\n            showQuickJumper: true,\n          }}\n        />\n      </Card>\n\n      {/* 创建分享模态框 */}\n      <Modal\n        title=\"创建文件分享\"\n        open={createModalVisible}\n        onOk={() => shareForm.submit()}\n        onCancel={() => setCreateModalVisible(false)}\n        confirmLoading={createShareMutation.isLoading}\n        width={600}\n      >\n        <Form\n          form={shareForm}\n          layout=\"vertical\"\n          onFinish={(values) => {\n            // 这里需要先选择文件，然后创建分享\n            // 简化起见，这里只是示例\n            message.info('请先在文件页面选择要分享的文件');\n          }}\n        >\n          <Form.Item>\n            <Text type=\"secondary\">\n              请前往\"我的文件\"页面，点击文件操作栏的分享按钮来创建分享链接。\n            </Text>\n          </Form.Item>\n          \n          <Form.Item\n            name=\"password\"\n            label=\"访问密码（可选）\"\n          >\n            <Input.Password placeholder=\"留空表示无需密码\" />\n          </Form.Item>\n          \n          <Form.Item\n            name=\"expire_at\"\n            label=\"过期时间（可选）\"\n          >\n            <DatePicker\n              showTime\n              placeholder=\"留空表示永不过期\"\n              style={{ width: '100%' }}\n            />\n          </Form.Item>\n          \n          <Form.Item\n            name=\"max_downloads\"\n            label=\"最大下载次数（可选）\"\n          >\n            <InputNumber\n              placeholder=\"留空表示无限制\"\n              style={{ width: '100%' }}\n              min={1}\n            />\n          </Form.Item>\n        </Form>\n      </Modal>\n    </div>\n  );\n};\n\nexport default Shares;","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\components\\Sidebar.js",[],"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\Files.js",[],"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\components\\Header.js",[],"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\services\\api.js",[],"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\utils\\format.js",[],"D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\ShareView.js",["87","88"],"import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { \n  Card, \n  Button, \n  Input, \n  Spin, \n  message, \n  Descriptions, \n  Tag,\n  Space,\n  Typography,\n  Alert,\n  Modal\n} from 'antd';\nimport { \n  DownloadOutlined, \n  LockOutlined, \n  FileOutlined,\n  ClockCircleOutlined,\n  NumberOutlined,\n  CloudUploadOutlined,\n  SaveOutlined,\n  FolderOutlined\n} from '@ant-design/icons';\nimport api from '../services/api';\nimport FolderSelector from '../components/FolderSelector';\n\nconst { Title, Text } = Typography;\n\nconst ShareView = () => {\n  const { shareCode } = useParams();\n  const navigate = useNavigate();\n  const [loading, setLoading] = useState(true);\n  const [downloading, setDownloading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [shareInfo, setShareInfo] = useState(null);\n  const [password, setPassword] = useState('');\n  const [passwordRequired, setPasswordRequired] = useState(false);\n  const [error, setError] = useState('');\n  const [showSaveModal, setShowSaveModal] = useState(false);\n  const [showFolderSelector, setShowFolderSelector] = useState(false);\n\n  useEffect(() => {\n    fetchShareInfo();\n  }, [shareCode]);\n\n  const fetchShareInfo = async (pwd = '') => {\n    try {\n      setLoading(true);\n      setError('');\n      \n      const response = await api.get(`/api/files/share/${shareCode}/`, {\n        params: pwd ? { password: pwd } : {}\n      });\n      \n      setShareInfo(response.data);\n      setPasswordRequired(false);\n    } catch (error) {\n      if (error.response?.status === 403 && error.response?.data?.error === '需要密码') {\n        setPasswordRequired(true);\n      } else if (error.response?.status === 404) {\n        setError('分享链接不存在或已过期');\n      } else {\n        setError(error.response?.data?.error || '获取分享信息失败');\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handlePasswordSubmit = () => {\n    if (!password.trim()) {\n      message.error('请输入密码');\n      return;\n    }\n    fetchShareInfo(password);\n  };\n\n  const handleDownload = async () => {\n    try {\n      setDownloading(true);\n      \n      const response = await api.post(`/api/files/share/${shareCode}/download/`, \n        passwordRequired ? { password } : {},\n        {\n          responseType: 'blob'\n        }\n      );\n\n      // 创建下载链接\n      const blob = new Blob([response.data]);\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      \n      // 从响应头获取文件名\n      const contentDisposition = response.headers['content-disposition'];\n      let filename = shareInfo?.file_name || shareInfo?.original_name || 'download';\n      if (contentDisposition) {\n        const filenameMatch = contentDisposition.match(/filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/);\n        if (filenameMatch && filenameMatch[1]) {\n          filename = filenameMatch[1].replace(/['\"]/g, '');\n        }\n      }\n      \n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n\n      message.success('文件下载成功！');\n      \n      // 更新下载次数\n      if (shareInfo) {\n        setShareInfo({\n          ...shareInfo,\n          download_count: shareInfo.download_count + 1\n        });\n      }\n    } catch (error) {\n      message.error(error.response?.data?.error || '下载失败');\n    } finally {\n      setDownloading(false);\n    }\n  };\n\n  const formatFileSize = (bytes) => {\n    if (!bytes) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const formatDate = (dateString) => {\n    if (!dateString) return null;\n    return new Date(dateString).toLocaleString('zh-CN');\n  };\n\n  const handleSaveToCloud = async (folderId = null) => {\n    try {\n      setSaving(true);\n      \n      const saveData = {\n        share_code: shareCode,\n        folder_id: folderId,\n        password: passwordRequired ? password : undefined\n      };\n\n      const response = await api.post('/api/files/save-shared-file/', saveData);\n      \n      message.success('文件已保存到您的云盘！');\n      setShowSaveModal(false);\n      \n      // 询问是否跳转到文件管理页面\n      setTimeout(() => {\n        if (window.confirm('文件已保存成功！是否前往文件管理页面查看？')) {\n          navigate('/login');\n        }\n      }, 1000);\n      \n    } catch (error) {\n      if (error.response?.status === 401) {\n        message.error('请先登录后再保存文件到云盘');\n        navigate('/login');\n      } else {\n        message.error(error.response?.data?.error || '保存到云盘失败');\n      }\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleFolderSelect = (folderId) => {\n    setShowFolderSelector(false);\n    handleSaveToCloud(folderId);\n  };\n\n  const renderSaveModal = () => {\n    return (\n      <Modal\n        title={\n          <Space>\n            <CloudUploadOutlined />\n            保存到云盘\n          </Space>\n        }\n        open={showSaveModal}\n        onCancel={() => setShowSaveModal(false)}\n        footer={null}\n        width={500}\n      >\n        <Alert\n          message={`将文件 \"${shareInfo?.file_name || '未知文件'}\" 保存到您的云盘`}\n          type=\"info\"\n          showIcon\n          style={{ marginBottom: 20 }}\n        />\n        \n        <Space direction=\"vertical\" style={{ width: '100%' }}>\n          <Button \n            block \n            icon={<SaveOutlined />}\n            onClick={() => handleSaveToCloud(null)}\n            loading={saving}\n          >\n            保存到根目录\n          </Button>\n          \n          <Button \n            block \n            icon={<FolderOutlined />}\n            onClick={() => {\n              setShowSaveModal(false);\n              setShowFolderSelector(true);\n            }}\n            loading={saving}\n          >\n            选择文件夹保存\n          </Button>\n          \n          <Button onClick={() => setShowSaveModal(false)}>\n            取消\n          </Button>\n        </Space>\n      </Modal>\n    );\n  };\n\n  if (loading) {\n    return (\n      <div style={{ \n        display: 'flex', \n        justifyContent: 'center', \n        alignItems: 'center', \n        minHeight: '60vh' \n      }}>\n        <Spin size=\"large\" tip=\"加载中...\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div style={{ maxWidth: 600, margin: '50px auto' }}>\n        <Alert\n          message=\"访问失败\"\n          description={error}\n          type=\"error\"\n          showIcon\n          action={\n            <Button type=\"primary\" onClick={() => navigate('/login')}>\n              返回登录\n            </Button>\n          }\n        />\n      </div>\n    );\n  }\n\n  if (passwordRequired && !shareInfo) {\n    return (\n      <div style={{ maxWidth: 400, margin: '100px auto' }}>\n        <Card>\n          <Title level={3} style={{ textAlign: 'center', marginBottom: 30 }}>\n            <LockOutlined /> 访问受保护的分享\n          </Title>\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\n            <Input.Password\n              placeholder=\"请输入访问密码\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              onPressEnter={handlePasswordSubmit}\n            />\n            <Button \n              type=\"primary\" \n              block \n              onClick={handlePasswordSubmit}\n              loading={loading}\n            >\n              解锁访问\n            </Button>\n          </Space>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div style={{ maxWidth: 800, margin: '50px auto', padding: '0 20px' }}>\n      <Card>\n        <div style={{ textAlign: 'center', marginBottom: 30 }}>\n          <FileOutlined style={{ fontSize: 64, color: '#1890ff', marginBottom: 16 }} />\n          <Title level={2}>{shareInfo?.file_name || '未知文件'}</Title>\n        </div>\n\n        <Descriptions column={1} bordered style={{ marginBottom: 30 }}>\n          <Descriptions.Item label=\"文件大小\">\n            <Tag color=\"blue\">{formatFileSize(shareInfo.file_size)}</Tag>\n          </Descriptions.Item>\n          \n          <Descriptions.Item label=\"下载次数\">\n            <Space>\n              <NumberOutlined />\n              <Text strong>\n                {shareInfo.download_count} / {shareInfo.max_downloads || '无限制'}\n              </Text>\n            </Space>\n          </Descriptions.Item>\n\n          {shareInfo.expire_at && (\n            <Descriptions.Item label=\"过期时间\">\n              <Space>\n                <ClockCircleOutlined />\n                <Text type={new Date(shareInfo.expire_at) < new Date() ? 'danger' : 'success'}>\n                  {formatDate(shareInfo.expire_at)}\n                </Text>\n              </Space>\n            </Descriptions.Item>\n          )}\n\n          {shareInfo.password_protected && (\n            <Descriptions.Item label=\"访问保护\">\n              <Tag color=\"orange\"><LockOutlined /> 密码保护</Tag>\n            </Descriptions.Item>\n          )}\n\n          <Descriptions.Item label=\"分享时间\">\n            {formatDate(shareInfo.created_at)}\n          </Descriptions.Item>\n        </Descriptions>\n\n        <div style={{ textAlign: 'center' }}>\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\n            <Button\n              type=\"primary\"\n              size=\"large\"\n              icon={<DownloadOutlined />}\n              onClick={handleDownload}\n              loading={downloading}\n              disabled={\n                shareInfo.max_downloads > 0 && \n                shareInfo.download_count >= shareInfo.max_downloads\n              }\n              block\n            >\n              {shareInfo.max_downloads > 0 && \n               shareInfo.download_count >= shareInfo.max_downloads\n                ? '下载次数已用完'\n                : '直接下载到本地'\n              }\n            </Button>\n            \n            <Button\n              size=\"large\"\n              icon={<CloudUploadOutlined />}\n              onClick={() => setShowSaveModal(true)}\n              loading={saving}\n              block\n            >\n              保存到云盘\n            </Button>\n          </Space>\n        </div>\n\n        <div style={{ textAlign: 'center', marginTop: 20 }}>\n          <Button type=\"link\" onClick={() => navigate('/login')}>\n            返回登录页面\n          </Button>\n        </div>\n      </Card>\n      \n      {renderSaveModal()}\n      \n      <FolderSelector\n        visible={showFolderSelector}\n        onCancel={() => setShowFolderSelector(false)}\n        onConfirm={handleFolderSelect}\n        loading={saving}\n      />\n    </div>\n  );\n};\n\nexport default ShareView;","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\components\\ShareModal.js",["89"],"import React, { useState } from 'react';\nimport { \n  Modal, \n  Form, \n  Input, \n  DatePicker, \n  InputNumber, \n  Switch, \n  Button, \n  message, \n  Space,\n  Typography,\n  Divider,\n  Alert\n} from 'antd';\nimport { \n  ShareAltOutlined, \n  CopyOutlined, \n  LockOutlined,\n  ClockCircleOutlined,\n  NumberOutlined\n} from '@ant-design/icons';\nimport api from '../services/api';\nimport dayjs from 'dayjs';\n\nconst { Title, Text } = Typography;\n\nconst ShareModal = ({ visible, onCancel, file, onSuccess }) => {\n  const [form] = Form.useForm();\n  const [loading, setLoading] = useState(false);\n  const [shareLink, setShareLink] = useState('');\n  const [shareCreated, setShareCreated] = useState(false);\n\n  const handleSubmit = async (values) => {\n    try {\n      setLoading(true);\n      \n      const shareData = {\n        password: values.password || undefined,\n        expire_at: values.expire_at ? values.expire_at.toISOString() : undefined,\n        max_downloads: values.max_downloads || undefined\n      };\n\n      const response = await api.post(`/api/files/${file.id}/share/`, shareData);\n      \n      const fullShareLink = `${window.location.origin}/share/${response.data.share_code}`;\n      setShareLink(fullShareLink);\n      setShareCreated(true);\n      \n      message.success('分享创建成功！');\n      onSuccess?.();\n    } catch (error) {\n      message.error(error.response?.data?.error || '创建分享失败');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCopyLink = () => {\n    navigator.clipboard.writeText(shareLink);\n    message.success('链接已复制到剪贴板');\n  };\n\n  const handleCancel = () => {\n    form.resetFields();\n    setShareLink('');\n    setShareCreated(false);\n    onCancel();\n  };\n\n  const disabledDate = (current) => {\n    return current && current < dayjs().startOf('day');\n  };\n\n  return (\n    <Modal\n      title={\n        <Space>\n          <ShareAltOutlined />\n          创建文件分享\n        </Space>\n      }\n      open={visible}\n      onCancel={handleCancel}\n      footer={null}\n      width={600}\n    >\n      {!shareCreated ? (\n        <>\n          <Alert\n            message={`分享文件: ${file?.name}`}\n            type=\"info\"\n            showIcon\n            style={{ marginBottom: 20 }}\n          />\n          \n          <Form\n            form={form}\n            layout=\"vertical\"\n            onFinish={handleSubmit}\n          >\n            <Form.Item\n              name=\"password\"\n              label={\n                <Space>\n                  <LockOutlined />\n                  访问密码（可选）\n                </Space>\n              }\n              help=\"留空则无需密码即可访问\"\n            >\n              <Input.Password placeholder=\"设置访问密码\" />\n            </Form.Item>\n\n            <Divider />\n\n            <Form.Item\n              name=\"expire_at\"\n              label={\n                <Space>\n                  <ClockCircleOutlined />\n                  过期时间（可选）\n                </Space>\n              }\n              help=\"留空则永不过期\"\n            >\n              <DatePicker\n                showTime\n                placeholder=\"选择过期时间\"\n                disabledDate={disabledDate}\n                style={{ width: '100%' }}\n              />\n            </Form.Item>\n\n            <Form.Item\n              name=\"max_downloads\"\n              label={\n                <Space>\n                  <NumberOutlined />\n                  最大下载次数（可选）\n                </Space>\n              }\n              help=\"留空则无限制\"\n            >\n              <InputNumber\n                placeholder=\"设置最大下载次数\"\n                min={1}\n                style={{ width: '100%' }}\n              />\n            </Form.Item>\n\n            <Divider />\n\n            <Form.Item>\n              <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\n                <Button onClick={handleCancel}>\n                  取消\n                </Button>\n                <Button \n                  type=\"primary\" \n                  htmlType=\"submit\" \n                  loading={loading}\n                  icon={<ShareAltOutlined />}\n                >\n                  创建分享\n                </Button>\n              </Space>\n            </Form.Item>\n          </Form>\n        </>\n      ) : (\n        <div style={{ textAlign: 'center' }}>\n          <Title level={4}>\n            <ShareAltOutlined /> 分享创建成功！\n          </Title>\n          \n          <div style={{ \n            background: '#f5f5f5', \n            padding: 15, \n            borderRadius: 8, \n            margin: '20px 0',\n            wordBreak: 'break-all'\n          }}>\n            <Text copyable={{ text: shareLink }}>\n              {shareLink}\n            </Text>\n          </div>\n\n          <Space>\n            <Button \n              type=\"primary\" \n              icon={<CopyOutlined />}\n              onClick={handleCopyLink}\n            >\n              复制链接\n            </Button>\n            <Button onClick={handleCancel}>\n              关闭\n            </Button>\n          </Space>\n\n          <Alert\n            message=\"分享提示\"\n            description=\"任何人都可以通过此链接访问文件，请谨慎分享。如需取消分享，请在'我的分享'页面中删除。\"\n            type=\"warning\"\n            showIcon\n            style={{ marginTop: 20 }}\n          />\n        </div>\n      )}\n    </Modal>\n  );\n};\n\nexport default ShareModal;","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\components\\FolderSelector.js",["90","91","92"],"import React, { useState, useEffect } from 'react';\nimport { \n  Modal, \n  Tree, \n  Button, \n  message, \n  Spin,\n  Typography,\n  Space\n} from 'antd';\nimport { \n  FolderOutlined, \n  FileOutlined,\n  InboxOutlined\n} from '@ant-design/icons';\nimport api from '../services/api';\n\nconst { Title } = Typography;\n\nconst FolderSelector = ({ \n  visible, \n  onCancel, \n  onConfirm, \n  loading = false \n}) => {\n  const [treeData, setTreeData] = useState([]);\n  const [selectedKeys, setSelectedKeys] = useState([]);\n  const [loadingTree, setLoadingTree] = useState(false);\n\n  useEffect(() => {\n    if (visible) {\n      fetchFolders();\n    }\n  }, [visible]);\n\n  const fetchFolders = async () => {\n    try {\n      setLoadingTree(true);\n      const response = await api.get('/api/files/folders/');\n      \n      const folders = response.data;\n      const treeData = buildTreeData(folders);\n      \n      setTreeData([\n        {\n          title: '根目录',\n          key: 'root',\n          icon: <InboxOutlined />,\n          children: treeData\n        }\n      ]);\n    } catch (error) {\n      message.error('获取文件夹列表失败');\n    } finally {\n      setLoadingTree(false);\n    }\n  };\n\n  const buildTreeData = (folders, parentId = null) => {\n    return folders\n      .filter(folder => folder.parent === parentId)\n      .map(folder => ({\n        title: folder.name,\n        key: folder.id,\n        icon: <FolderOutlined />,\n        children: buildTreeData(folders, folder.id)\n      }));\n  };\n\n  const handleSelect = (selectedKeys) => {\n    setSelectedKeys(selectedKeys);\n  };\n\n  const handleConfirm = () => {\n    const selectedKey = selectedKeys[0];\n    const folderId = selectedKey === 'root' ? null : selectedKey;\n    onConfirm(folderId);\n  };\n\n  return (\n    <Modal\n      title={\n        <Space>\n          <FolderOutlined />\n          选择保存位置\n        </Space>\n      }\n      open={visible}\n      onCancel={onCancel}\n      footer={[\n        <Button key=\"cancel\" onClick={onCancel}>\n          取消\n        </Button>,\n        <Button \n          key=\"confirm\" \n          type=\"primary\" \n          onClick={handleConfirm}\n          loading={loading}\n        >\n          确认保存\n        </Button>\n      ]}\n      width={600}\n    >\n      <Spin spinning={loadingTree}>\n        <div style={{ minHeight: 300, maxHeight: 400, overflow: 'auto' }}>\n          {treeData.length > 0 ? (\n            <Tree\n              showIcon\n              defaultExpandAll\n              onSelect={handleSelect}\n              selectedKeys={selectedKeys}\n              treeData={treeData}\n            />\n          ) : (\n            <div style={{ textAlign: 'center', padding: '50px 0' }}>\n              <FolderOutlined style={{ fontSize: 48, color: '#d9d9d9' }} />\n              <div style={{ marginTop: 16, color: '#999' }}>\n                暂无文件夹，将保存到根目录\n              </div>\n            </div>\n          )}\n        </div>\n      </Spin>\n    </Modal>\n  );\n};\n\nexport default FolderSelector;","D:\\cloud-storage-system\\cloud-storage-system\\frontend\\src\\pages\\FileSearch.js",["93","94"],"import React, { useState } from 'react';\nimport { \n  Card, \n  Input, \n  Button, \n  Table, \n  Space, \n  Tag, \n  message, \n  Spin,\n  Descriptions,\n  Modal,\n  Typography,\n  Alert\n} from 'antd';\nimport { \n  SearchOutlined, \n  DownloadOutlined, \n  FileOutlined,\n  LockOutlined,\n  CloudUploadOutlined,\n  SaveOutlined,\n  FolderOutlined,\n  EyeOutlined\n} from '@ant-design/icons';\nimport api from '../services/api';\nimport FolderSelector from '../components/FolderSelector';\n\nconst { Title, Text } = Typography;\n\nconst FileSearch = () => {\n  const [shareCode, setShareCode] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [downloading, setDownloading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [searchResults, setSearchResults] = useState([]);\n  const [selectedFile, setSelectedFile] = useState(null);\n  const [passwordInput, setPasswordInput] = useState('');\n  const [passwordRequired, setPasswordRequired] = useState(false);\n  const [showPreviewModal, setShowPreviewModal] = useState(false);\n  const [showSaveModal, setShowSaveModal] = useState(false);\n  const [showFolderSelector, setShowFolderSelector] = useState(false);\n\n  const handleSearch = async () => {\n    if (!shareCode.trim()) {\n      message.error('请输入分享码');\n      return;\n    }\n\n    try {\n      setLoading(true);\n      \n      const response = await api.get(`/api/files/share/${shareCode.trim()}/`, {\n        params: passwordInput ? { password: passwordInput } : {}\n      });\n      \n      const fileInfo = response.data;\n      \n      // 添加到搜索结果（避免重复）\n      setSearchResults(prev => {\n        const exists = prev.find(item => item.share_code === shareCode.trim());\n        if (exists) {\n          message.warning('该分享文件已在结果列表中');\n          return prev;\n        }\n        return [...prev, {\n          ...fileInfo,\n          share_code: shareCode.trim(),\n          search_time: new Date().toISOString()\n        }];\n      });\n      \n      setShareCode('');\n      setPasswordInput('');\n      setPasswordRequired(false);\n      message.success('文件信息获取成功！');\n      \n    } catch (error) {\n      if (error.response?.status === 403 && error.response?.data?.error === '需要密码') {\n        setPasswordRequired(true);\n        message.warning('该分享文件需要密码，请输入密码后重试');\n      } else if (error.response?.status === 404) {\n        message.error('分享码不存在或已过期');\n      } else {\n        message.error(error.response?.data?.error || '获取文件信息失败');\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter') {\n      handleSearch();\n    }\n  };\n\n  const formatFileSize = (bytes) => {\n    if (!bytes) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const formatDate = (dateString) => {\n    if (!dateString) return '-';\n    return new Date(dateString).toLocaleString('zh-CN');\n  };\n\n  const getFileTypeColor = (fileName) => {\n    const ext = fileName.split('.').pop()?.toLowerCase();\n    const colorMap = {\n      pdf: 'red',\n      doc: 'blue', docx: 'blue',\n      xls: 'green', xlsx: 'green',\n      ppt: 'orange', pptx: 'orange',\n      jpg: 'purple', jpeg: 'purple', png: 'purple', gif: 'purple',\n      mp4: 'cyan', avi: 'cyan', mov: 'cyan',\n      zip: 'geekblue', rar: 'geekblue',\n      txt: 'default', md: 'default'\n    };\n    return colorMap[ext] || 'default';\n  };\n\n  const handlePreview = (record) => {\n    setSelectedFile(record);\n    setShowPreviewModal(true);\n    setPasswordRequired(false);\n    setPasswordInput('');\n  };\n\n  const handleDownload = async (fileInfo, password = null) => {\n    try {\n      setDownloading(true);\n      \n      const requestData = password ? { password } : {};\n      \n      const response = await api.post(`/api/files/share/${fileInfo.share_code}/download/`, \n        requestData,\n        {\n          responseType: 'blob'\n        }\n      );\n\n      // 创建下载链接\n      const blob = new Blob([response.data]);\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      \n      // 从响应头获取文件名\n      const contentDisposition = response.headers['content-disposition'];\n      let filename = fileInfo.file_name || 'download';\n      if (contentDisposition) {\n        const filenameMatch = contentDisposition.match(/filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/);\n        if (filenameMatch && filenameMatch[1]) {\n          filename = filenameMatch[1].replace(/['\"]/g, '');\n        }\n      }\n      \n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n\n      message.success('文件下载成功！');\n      \n      // 更新搜索结果中的下载次数\n      setSearchResults(prev => \n        prev.map(item => \n          item.share_code === fileInfo.share_code \n            ? { ...item, download_count: item.download_count + 1 }\n            : item\n        )\n      );\n      \n    } catch (error) {\n      if (error.response?.status === 403) {\n        message.error('密码错误或文件需要密码');\n      } else {\n        message.error(error.response?.data?.error || '下载失败');\n      }\n    } finally {\n      setDownloading(false);\n    }\n  };\n\n  const handleSaveToCloud = async (folderId = null) => {\n    if (!selectedFile) return;\n\n    try {\n      setSaving(true);\n      \n      const saveData = {\n        share_code: selectedFile.share_code,\n        folder_id: folderId,\n        password: passwordRequired ? passwordInput : undefined\n      };\n\n      const response = await api.post('/api/files/save-shared-file/', saveData);\n      \n      message.success('文件已保存到您的云盘！');\n      setShowSaveModal(false);\n      setShowPreviewModal(false);\n      \n    } catch (error) {\n      if (error.response?.status === 401) {\n        message.error('请先登录后再保存文件到云盘');\n      } else {\n        message.error(error.response?.data?.error || '保存到云盘失败');\n      }\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleFolderSelect = (folderId) => {\n    setShowFolderSelector(false);\n    handleSaveToCloud(folderId);\n  };\n\n  const columns = [\n    {\n      title: '文件名',\n      dataIndex: 'file_name',\n      key: 'file_name',\n      render: (text, record) => (\n        <Space>\n          <FileOutlined style={{ color: '#1890ff' }} />\n          <span>{text}</span>\n          <Tag color={getFileTypeColor(text)}>\n            {text.split('.').pop()?.toUpperCase()}\n          </Tag>\n        </Space>\n      )\n    },\n    {\n      title: '文件大小',\n      dataIndex: 'file_size',\n      key: 'file_size',\n      render: (size) => formatFileSize(size)\n    },\n    {\n      title: '分享码',\n      dataIndex: 'share_code',\n      key: 'share_code',\n      render: (code) => (\n        <Text code copyable={{ text: code }}>\n          {code}\n        </Text>\n      )\n    },\n    {\n      title: '下载次数',\n      dataIndex: 'download_count',\n      key: 'download_count',\n      render: (count, record) => (\n        <Text>\n          {count} / {record.max_downloads || '无限制'}\n        </Text>\n      )\n    },\n    {\n      title: '搜索时间',\n      dataIndex: 'search_time',\n      key: 'search_time',\n      render: (time) => formatDate(time)\n    },\n    {\n      title: '操作',\n      key: 'action',\n      render: (_, record) => (\n        <Space>\n          <Button\n            type=\"primary\"\n            size=\"small\"\n            icon={<EyeOutlined />}\n            onClick={() => handlePreview(record)}\n          >\n            查看\n          </Button>\n          <Button\n            type=\"default\"\n            size=\"small\"\n            icon={<DownloadOutlined />}\n            onClick={() => handleDownload(record)}\n            loading={downloading}\n            disabled={\n              record.max_downloads > 0 && \n              record.download_count >= record.max_downloads\n            }\n          >\n            下载\n          </Button>\n        </Space>\n      )\n    }\n  ];\n\n  const renderPreviewModal = () => {\n    if (!selectedFile) return null;\n\n    return (\n      <Modal\n        title={\n          <Space>\n            <FileOutlined />\n            文件详情\n          </Space>\n        }\n        open={showPreviewModal}\n        onCancel={() => {\n          setShowPreviewModal(false);\n          setPasswordRequired(false);\n          setPasswordInput('');\n        }}\n        footer={null}\n        width={700}\n      >\n        <div style={{ textAlign: 'center', marginBottom: 24 }}>\n          <FileOutlined style={{ fontSize: 48, color: '#1890ff', marginBottom: 16 }} />\n          <Title level={3}>{selectedFile.file_name}</Title>\n        </div>\n\n        <Descriptions column={1} bordered style={{ marginBottom: 24 }}>\n          <Descriptions.Item label=\"文件大小\">\n            <Tag color=\"blue\">{formatFileSize(selectedFile.file_size)}</Tag>\n          </Descriptions.Item>\n          \n          <Descriptions.Item label=\"分享码\">\n            <Text code copyable={{ text: selectedFile.share_code }}>\n              {selectedFile.share_code}\n            </Text>\n          </Descriptions.Item>\n          \n          <Descriptions.Item label=\"下载次数\">\n            <Text strong>\n              {selectedFile.download_count} / {selectedFile.max_downloads || '无限制'}\n            </Text>\n          </Descriptions.Item>\n\n          {selectedFile.expire_at && (\n            <Descriptions.Item label=\"过期时间\">\n              <Text type={new Date(selectedFile.expire_at) < new Date() ? 'danger' : 'success'}>\n                {formatDate(selectedFile.expire_at)}\n              </Text>\n            </Descriptions.Item>\n          )}\n\n          {selectedFile.password_protected && (\n            <Descriptions.Item label=\"访问保护\">\n              <Tag color=\"orange\"><LockOutlined /> 密码保护</Tag>\n            </Descriptions.Item>\n          )}\n\n          <Descriptions.Item label=\"分享时间\">\n            {formatDate(selectedFile.created_at)}\n          </Descriptions.Item>\n        </Descriptions>\n\n        {selectedFile.password_protected && (\n          <div style={{ marginBottom: 16 }}>\n            <Input.Password\n              placeholder=\"请输入访问密码\"\n              value={passwordInput}\n              onChange={(e) => setPasswordInput(e.target.value)}\n              prefix={<LockOutlined />}\n            />\n          </div>\n        )}\n\n        <Space direction=\"vertical\" style={{ width: '100%' }}>\n          <Button\n            type=\"primary\"\n            size=\"large\"\n            icon={<DownloadOutlined />}\n            onClick={() => handleDownload(selectedFile, passwordInput)}\n            loading={downloading}\n            disabled={selectedFile.password_protected && !passwordInput.trim()}\n            block\n          >\n            直接下载到本地\n          </Button>\n          \n          <Button\n            size=\"large\"\n            icon={<CloudUploadOutlined />}\n            onClick={() => {\n              if (selectedFile.password_protected && !passwordInput.trim()) {\n                message.error('请先输入密码');\n                return;\n              }\n              setShowSaveModal(true);\n            }}\n            loading={saving}\n            disabled={selectedFile.password_protected && !passwordInput.trim()}\n            block\n          >\n            保存到云盘\n          </Button>\n        </Space>\n      </Modal>\n    );\n  };\n\n  const renderSaveModal = () => {\n    if (!selectedFile) return null;\n\n    return (\n      <Modal\n        title={\n          <Space>\n            <CloudUploadOutlined />\n            保存到云盘\n          </Space>\n        }\n        open={showSaveModal}\n        onCancel={() => setShowSaveModal(false)}\n        footer={null}\n        width={500}\n      >\n        <Alert\n          message={`将文件 \"${selectedFile.file_name}\" 保存到您的云盘`}\n          type=\"info\"\n          showIcon\n          style={{ marginBottom: 20 }}\n        />\n        \n        <Space direction=\"vertical\" style={{ width: '100%' }}>\n          <Button \n            block \n            icon={<SaveOutlined />}\n            onClick={() => handleSaveToCloud(null)}\n            loading={saving}\n          >\n            保存到根目录\n          </Button>\n          \n          <Button \n            block \n            icon={<FolderOutlined />}\n            onClick={() => {\n              setShowSaveModal(false);\n              setShowFolderSelector(true);\n            }}\n            loading={saving}\n          >\n            选择文件夹保存\n          </Button>\n          \n          <Button onClick={() => setShowSaveModal(false)}>\n            取消\n          </Button>\n        </Space>\n      </Modal>\n    );\n  };\n\n  return (\n    <div style={{ padding: '24px' }}>\n      <Card style={{ marginBottom: '24px' }}>\n        <Title level={3} style={{ marginBottom: '20px' }}>\n          <SearchOutlined /> 搜索分享文件\n        </Title>\n        \n        <Space.Compact style={{ width: '100%' }}>\n          <Input\n            placeholder=\"请输入分享码\"\n            value={shareCode}\n            onChange={(e) => setShareCode(e.target.value)}\n            onKeyPress={handleKeyPress}\n            style={{ flex: 1 }}\n            prefix={<SearchOutlined />}\n          />\n          <Button \n            type=\"primary\" \n            icon={<SearchOutlined />}\n            onClick={handleSearch}\n            loading={loading}\n          >\n            搜索\n          </Button>\n        </Space.Compact>\n\n        {passwordRequired && (\n          <Alert\n            message=\"该分享文件需要密码\"\n            description=\"请在下方输入密码，然后重新搜索\"\n            type=\"warning\"\n            showIcon\n            style={{ marginTop: 16 }}\n          />\n        )}\n      </Card>\n\n      <Card>\n        <Title level={4} style={{ marginBottom: '16px' }}>\n          搜索结果 ({searchResults.length})\n        </Title>\n        \n        <Table\n          columns={columns}\n          dataSource={searchResults}\n          rowKey=\"share_code\"\n          pagination={{\n            pageSize: 10,\n            showSizeChanger: true,\n            showQuickJumper: true,\n            showTotal: (total) => `共找到 ${total} 个文件`,\n            locale: { emptyText: '暂无搜索结果，请输入分享码进行搜索' }\n          }}\n          locale={{ emptyText: '暂无搜索结果，请输入分享码进行搜索' }}\n        />\n      </Card>\n\n      {renderPreviewModal()}\n      {renderSaveModal()}\n      \n      <FolderSelector\n        visible={showFolderSelector}\n        onCancel={() => setShowFolderSelector(false)}\n        onConfirm={handleFolderSelect}\n        loading={saving}\n      />\n    </div>\n  );\n};\n\nexport default FileSearch;",{"ruleId":"95","replacedBy":"96"},{"ruleId":"97","replacedBy":"98"},{"ruleId":"99","severity":1,"message":"100","line":2,"column":58,"nodeType":"101","messageId":"102","endLine":2,"endColumn":62},{"ruleId":"99","severity":1,"message":"103","line":3,"column":53,"nodeType":"101","messageId":"102","endLine":3,"endColumn":67},{"ruleId":"99","severity":1,"message":"104","line":20,"column":15,"nodeType":"101","messageId":"102","endLine":20,"endColumn":23},{"ruleId":"99","severity":1,"message":"105","line":19,"column":3,"nodeType":"101","messageId":"102","endLine":19,"endColumn":19},{"ruleId":"99","severity":1,"message":"106","line":29,"column":10,"nodeType":"101","messageId":"102","endLine":29,"endColumn":21},{"ruleId":"99","severity":1,"message":"107","line":29,"column":23,"nodeType":"101","messageId":"102","endLine":29,"endColumn":37},{"ruleId":"99","severity":1,"message":"108","line":29,"column":39,"nodeType":"101","messageId":"102","endLine":29,"endColumn":50},{"ruleId":"99","severity":1,"message":"109","line":32,"column":9,"nodeType":"101","messageId":"102","endLine":32,"endColumn":20},{"ruleId":"110","severity":1,"message":"111","line":46,"column":6,"nodeType":"112","endLine":46,"endColumn":17,"suggestions":"113"},{"ruleId":"99","severity":1,"message":"104","line":152,"column":13,"nodeType":"101","messageId":"102","endLine":152,"endColumn":21},{"ruleId":"99","severity":1,"message":"114","line":8,"column":3,"nodeType":"101","messageId":"102","endLine":8,"endColumn":9},{"ruleId":"99","severity":1,"message":"115","line":13,"column":3,"nodeType":"101","messageId":"102","endLine":13,"endColumn":15},{"ruleId":"99","severity":1,"message":"116","line":18,"column":9,"nodeType":"101","messageId":"102","endLine":18,"endColumn":14},{"ruleId":"110","severity":1,"message":"117","line":34,"column":6,"nodeType":"112","endLine":34,"endColumn":15,"suggestions":"118"},{"ruleId":"99","severity":1,"message":"100","line":10,"column":3,"nodeType":"101","messageId":"102","endLine":10,"endColumn":7},{"ruleId":"99","severity":1,"message":"104","line":202,"column":13,"nodeType":"101","messageId":"102","endLine":202,"endColumn":21},"no-native-reassign",["119"],"no-negated-in-lhs",["120"],"no-unused-vars","'Spin' is defined but never used.","Identifier","unusedVar","'ReloadOutlined' is defined but never used.","'response' is assigned a value but never used.","'ShareAltOutlined' is defined but never used.","'formatBytes' is defined but never used.","'formatDateTime' is defined but never used.","'getFileIcon' is defined but never used.","'RangePicker' is assigned a value but never used.","react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'fetchShareInfo'. Either include it or remove the dependency array.","ArrayExpression",["121"],"'Switch' is defined but never used.","'FileOutlined' is defined but never used.","'Title' is assigned a value but never used.","React Hook useEffect has a missing dependency: 'fetchFolders'. Either include it or remove the dependency array.",["122"],"no-global-assign","no-unsafe-negation",{"desc":"123","fix":"124"},{"desc":"125","fix":"126"},"Update the dependencies array to be: [fetchShareInfo, shareCode]",{"range":"127","text":"128"},"Update the dependencies array to be: [fetchFolders, visible]",{"range":"129","text":"130"},[1210,1221],"[fetchShareInfo, shareCode]",[632,641],"[fetchFolders, visible]"]