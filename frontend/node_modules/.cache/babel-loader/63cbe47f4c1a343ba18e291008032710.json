{"ast":null,"code":"var _jsxFileName = \"D:\\\\cloud-storage-system\\\\cloud-storage-system\\\\frontend\\\\src\\\\pages\\\\ShareView.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { Card, Button, Input, Spin, message, Descriptions, Tag, Space, Typography, Alert, Modal } from 'antd';\nimport { DownloadOutlined, LockOutlined, FileOutlined, ClockCircleOutlined, NumberOutlined, CloudUploadOutlined, SaveOutlined, FolderOutlined } from '@ant-design/icons';\nimport api from '../services/api';\nimport FolderSelector from '../components/FolderSelector';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Title,\n  Text\n} = Typography;\nconst ShareView = () => {\n  _s();\n  const {\n    shareCode\n  } = useParams();\n  const navigate = useNavigate();\n  const [loading, setLoading] = useState(true);\n  const [downloading, setDownloading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [shareInfo, setShareInfo] = useState(null);\n  const [password, setPassword] = useState('');\n  const [passwordRequired, setPasswordRequired] = useState(false);\n  const [error, setError] = useState('');\n  const [showSaveModal, setShowSaveModal] = useState(false);\n  const [showFolderSelector, setShowFolderSelector] = useState(false);\n  useEffect(() => {\n    fetchShareInfo();\n  }, [shareCode]);\n  const fetchShareInfo = async (pwd = '') => {\n    try {\n      setLoading(true);\n      setError('');\n      const response = await api.get(`/api/files/share/${shareCode}/`, {\n        params: pwd ? {\n          password: pwd\n        } : {}\n      });\n      setShareInfo(response.data);\n      setPasswordRequired(false);\n    } catch (error) {\n      var _error$response, _error$response2, _error$response2$data, _error$response3;\n      if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 403 && ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.error) === '需要密码') {\n        setPasswordRequired(true);\n      } else if (((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.status) === 404) {\n        setError('分享链接不存在或已过期');\n      } else {\n        var _error$response4, _error$response4$data;\n        setError(((_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : (_error$response4$data = _error$response4.data) === null || _error$response4$data === void 0 ? void 0 : _error$response4$data.error) || '获取分享信息失败');\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handlePasswordSubmit = () => {\n    if (!password.trim()) {\n      message.error('请输入密码');\n      return;\n    }\n    fetchShareInfo(password);\n  };\n  const handleDownload = async () => {\n    try {\n      setDownloading(true);\n      const response = await api.post(`/api/files/share/${shareCode}/download/`, passwordRequired ? {\n        password\n      } : {}, {\n        responseType: 'blob'\n      });\n\n      // 创建下载链接\n      const blob = new Blob([response.data]);\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n\n      // 从响应头获取文件名\n      const contentDisposition = response.headers['content-disposition'];\n      let filename = (shareInfo === null || shareInfo === void 0 ? void 0 : shareInfo.file_name) || 'download';\n      if (contentDisposition) {\n        const filenameMatch = contentDisposition.match(/filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/);\n        if (filenameMatch && filenameMatch[1]) {\n          filename = filenameMatch[1].replace(/['\"]/g, '');\n        }\n      }\n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n      message.success('文件下载成功！');\n\n      // 更新下载次数\n      if (shareInfo) {\n        setShareInfo({\n          ...shareInfo,\n          download_count: shareInfo.download_count + 1\n        });\n      }\n    } catch (error) {\n      var _error$response5, _error$response5$data;\n      message.error(((_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : (_error$response5$data = _error$response5.data) === null || _error$response5$data === void 0 ? void 0 : _error$response5$data.error) || '下载失败');\n    } finally {\n      setDownloading(false);\n    }\n  };\n  const formatFileSize = bytes => {\n    if (!bytes) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n  const formatDate = dateString => {\n    if (!dateString) return null;\n    return new Date(dateString).toLocaleString('zh-CN');\n  };\n  const handleSaveToCloud = async (folderId = null) => {\n    try {\n      setSaving(true);\n      const saveData = {\n        share_code: shareCode,\n        folder_id: folderId,\n        password: passwordRequired ? password : undefined\n      };\n      const response = await api.post('/api/files/save-shared-file/', saveData);\n      message.success('文件已保存到您的云盘！');\n      setShowSaveModal(false);\n\n      // 询问是否跳转到文件管理页面\n      setTimeout(() => {\n        if (window.confirm('文件已保存成功！是否前往文件管理页面查看？')) {\n          navigate('/login');\n        }\n      }, 1000);\n    } catch (error) {\n      var _error$response6;\n      if (((_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : _error$response6.status) === 401) {\n        message.error('请先登录后再保存文件到云盘');\n        navigate('/login');\n      } else {\n        var _error$response7, _error$response7$data;\n        message.error(((_error$response7 = error.response) === null || _error$response7 === void 0 ? void 0 : (_error$response7$data = _error$response7.data) === null || _error$response7$data === void 0 ? void 0 : _error$response7$data.error) || '保存到云盘失败');\n      }\n    } finally {\n      setSaving(false);\n    }\n  };\n  const handleFolderSelect = folderId => {\n    setShowFolderSelector(false);\n    handleSaveToCloud(folderId);\n  };\n  const renderSaveModal = () => {\n    return /*#__PURE__*/_jsxDEV(Modal, {\n      title: /*#__PURE__*/_jsxDEV(Space, {\n        children: [/*#__PURE__*/_jsxDEV(CloudUploadOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 13\n        }, this), \"\\u4FDD\\u5B58\\u5230\\u4E91\\u76D8\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 11\n      }, this),\n      open: showSaveModal,\n      onCancel: () => setShowSaveModal(false),\n      footer: null,\n      width: 500,\n      children: [/*#__PURE__*/_jsxDEV(Alert, {\n        message: `将文件 \"${shareInfo === null || shareInfo === void 0 ? void 0 : shareInfo.file_name}\" 保存到您的云盘`,\n        type: \"info\",\n        showIcon: true,\n        style: {\n          marginBottom: 20\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Space, {\n        direction: \"vertical\",\n        style: {\n          width: '100%'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          block: true,\n          icon: /*#__PURE__*/_jsxDEV(SaveOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 19\n          }, this),\n          onClick: () => handleSaveToCloud(null),\n          loading: saving,\n          children: \"\\u4FDD\\u5B58\\u5230\\u6839\\u76EE\\u5F55\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          block: true,\n          icon: /*#__PURE__*/_jsxDEV(FolderOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 214,\n            columnNumber: 19\n          }, this),\n          onClick: () => {\n            setShowSaveModal(false);\n            setShowFolderSelector(true);\n          },\n          loading: saving,\n          children: \"\\u9009\\u62E9\\u6587\\u4EF6\\u5939\\u4FDD\\u5B58\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: () => setShowSaveModal(false),\n          children: \"\\u53D6\\u6D88\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 7\n    }, this);\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        minHeight: '60vh'\n      },\n      children: /*#__PURE__*/_jsxDEV(Spin, {\n        size: \"large\",\n        tip: \"\\u52A0\\u8F7D\\u4E2D...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        maxWidth: 600,\n        margin: '50px auto'\n      },\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        message: \"\\u8BBF\\u95EE\\u5931\\u8D25\",\n        description: error,\n        type: \"error\",\n        showIcon: true,\n        action: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          onClick: () => navigate('/login'),\n          children: \"\\u8FD4\\u56DE\\u767B\\u5F55\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 7\n    }, this);\n  }\n  if (passwordRequired && !shareInfo) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        maxWidth: 400,\n        margin: '100px auto'\n      },\n      children: /*#__PURE__*/_jsxDEV(Card, {\n        children: [/*#__PURE__*/_jsxDEV(Title, {\n          level: 3,\n          style: {\n            textAlign: 'center',\n            marginBottom: 30\n          },\n          children: [/*#__PURE__*/_jsxDEV(LockOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 13\n          }, this), \" \\u8BBF\\u95EE\\u53D7\\u4FDD\\u62A4\\u7684\\u5206\\u4EAB\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Space, {\n          direction: \"vertical\",\n          style: {\n            width: '100%'\n          },\n          children: [/*#__PURE__*/_jsxDEV(Input.Password, {\n            placeholder: \"\\u8BF7\\u8F93\\u5165\\u8BBF\\u95EE\\u5BC6\\u7801\",\n            value: password,\n            onChange: e => setPassword(e.target.value),\n            onPressEnter: handlePasswordSubmit\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 271,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            type: \"primary\",\n            block: true,\n            onClick: handlePasswordSubmit,\n            loading: loading,\n            children: \"\\u89E3\\u9501\\u8BBF\\u95EE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      maxWidth: 800,\n      margin: '50px auto',\n      padding: '0 20px'\n    },\n    children: [/*#__PURE__*/_jsxDEV(Card, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          marginBottom: 30\n        },\n        children: [/*#__PURE__*/_jsxDEV(FileOutlined, {\n          style: {\n            fontSize: 64,\n            color: '#1890ff',\n            marginBottom: 16\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Title, {\n          level: 2,\n          children: (shareInfo === null || shareInfo === void 0 ? void 0 : shareInfo.file_name) || '未知文件'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Descriptions, {\n        column: 1,\n        bordered: true,\n        style: {\n          marginBottom: 30\n        },\n        children: [/*#__PURE__*/_jsxDEV(Descriptions.Item, {\n          label: \"\\u6587\\u4EF6\\u5927\\u5C0F\",\n          children: /*#__PURE__*/_jsxDEV(Tag, {\n            color: \"blue\",\n            children: formatFileSize(shareInfo.file_size)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 301,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Descriptions.Item, {\n          label: \"\\u4E0B\\u8F7D\\u6B21\\u6570\",\n          children: /*#__PURE__*/_jsxDEV(Space, {\n            children: [/*#__PURE__*/_jsxDEV(NumberOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 306,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Text, {\n              strong: true,\n              children: [shareInfo.download_count, \" / \", shareInfo.max_downloads || '无限制']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 307,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 305,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 304,\n          columnNumber: 11\n        }, this), shareInfo.expire_at && /*#__PURE__*/_jsxDEV(Descriptions.Item, {\n          label: \"\\u8FC7\\u671F\\u65F6\\u95F4\",\n          children: /*#__PURE__*/_jsxDEV(Space, {\n            children: [/*#__PURE__*/_jsxDEV(ClockCircleOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 316,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Text, {\n              type: new Date(shareInfo.expire_at) < new Date() ? 'danger' : 'success',\n              children: formatDate(shareInfo.expire_at)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 317,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 315,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 314,\n          columnNumber: 13\n        }, this), shareInfo.password_protected && /*#__PURE__*/_jsxDEV(Descriptions.Item, {\n          label: \"\\u8BBF\\u95EE\\u4FDD\\u62A4\",\n          children: /*#__PURE__*/_jsxDEV(Tag, {\n            color: \"orange\",\n            children: [/*#__PURE__*/_jsxDEV(LockOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 326,\n              columnNumber: 35\n            }, this), \" \\u5BC6\\u7801\\u4FDD\\u62A4\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Descriptions.Item, {\n          label: \"\\u5206\\u4EAB\\u65F6\\u95F4\",\n          children: formatDate(shareInfo.created_at)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center'\n        },\n        children: /*#__PURE__*/_jsxDEV(Space, {\n          direction: \"vertical\",\n          style: {\n            width: '100%'\n          },\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            type: \"primary\",\n            size: \"large\",\n            icon: /*#__PURE__*/_jsxDEV(DownloadOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 340,\n              columnNumber: 21\n            }, this),\n            onClick: handleDownload,\n            loading: downloading,\n            disabled: shareInfo.max_downloads > 0 && shareInfo.download_count >= shareInfo.max_downloads,\n            block: true,\n            children: shareInfo.max_downloads > 0 && shareInfo.download_count >= shareInfo.max_downloads ? '下载次数已用完' : '直接下载到本地'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 337,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            size: \"large\",\n            icon: /*#__PURE__*/_jsxDEV(CloudUploadOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 358,\n              columnNumber: 21\n            }, this),\n            onClick: () => setShowSaveModal(true),\n            loading: saving,\n            block: true,\n            children: \"\\u4FDD\\u5B58\\u5230\\u4E91\\u76D8\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 356,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 336,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 335,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          marginTop: 20\n        },\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"link\",\n          onClick: () => navigate('/login'),\n          children: \"\\u8FD4\\u56DE\\u767B\\u5F55\\u9875\\u9762\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 369,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 368,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 7\n    }, this), renderSaveModal(), /*#__PURE__*/_jsxDEV(FolderSelector, {\n      visible: showFolderSelector,\n      onCancel: () => setShowFolderSelector(false),\n      onConfirm: handleFolderSelect,\n      loading: saving\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 377,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 292,\n    columnNumber: 5\n  }, this);\n};\n_s(ShareView, \"VXA0Pj/2o+WykJiTz7kEHKpEaco=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = ShareView;\nexport default ShareView;\nvar _c;\n$RefreshReg$(_c, \"ShareView\");","map":{"version":3,"names":["React","useState","useEffect","useParams","useNavigate","Card","Button","Input","Spin","message","Descriptions","Tag","Space","Typography","Alert","Modal","DownloadOutlined","LockOutlined","FileOutlined","ClockCircleOutlined","NumberOutlined","CloudUploadOutlined","SaveOutlined","FolderOutlined","api","FolderSelector","jsxDEV","_jsxDEV","Title","Text","ShareView","_s","shareCode","navigate","loading","setLoading","downloading","setDownloading","saving","setSaving","shareInfo","setShareInfo","password","setPassword","passwordRequired","setPasswordRequired","error","setError","showSaveModal","setShowSaveModal","showFolderSelector","setShowFolderSelector","fetchShareInfo","pwd","response","get","params","data","_error$response","_error$response2","_error$response2$data","_error$response3","status","_error$response4","_error$response4$data","handlePasswordSubmit","trim","handleDownload","post","responseType","blob","Blob","url","window","URL","createObjectURL","link","document","createElement","href","contentDisposition","headers","filename","file_name","filenameMatch","match","replace","download","body","appendChild","click","removeChild","revokeObjectURL","success","download_count","_error$response5","_error$response5$data","formatFileSize","bytes","k","sizes","i","Math","floor","log","parseFloat","pow","toFixed","formatDate","dateString","Date","toLocaleString","handleSaveToCloud","folderId","saveData","share_code","folder_id","undefined","setTimeout","confirm","_error$response6","_error$response7","_error$response7$data","handleFolderSelect","renderSaveModal","title","children","fileName","_jsxFileName","lineNumber","columnNumber","open","onCancel","footer","width","type","showIcon","style","marginBottom","direction","block","icon","onClick","display","justifyContent","alignItems","minHeight","size","tip","maxWidth","margin","description","action","level","textAlign","Password","placeholder","value","onChange","e","target","onPressEnter","padding","fontSize","color","column","bordered","Item","label","file_size","strong","max_downloads","expire_at","password_protected","created_at","disabled","marginTop","visible","onConfirm","_c","$RefreshReg$"],"sources":["D:/cloud-storage-system/cloud-storage-system/frontend/src/pages/ShareView.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { \n  Card, \n  Button, \n  Input, \n  Spin, \n  message, \n  Descriptions, \n  Tag,\n  Space,\n  Typography,\n  Alert,\n  Modal\n} from 'antd';\nimport { \n  DownloadOutlined, \n  LockOutlined, \n  FileOutlined,\n  ClockCircleOutlined,\n  NumberOutlined,\n  CloudUploadOutlined,\n  SaveOutlined,\n  FolderOutlined\n} from '@ant-design/icons';\nimport api from '../services/api';\nimport FolderSelector from '../components/FolderSelector';\n\nconst { Title, Text } = Typography;\n\nconst ShareView = () => {\n  const { shareCode } = useParams();\n  const navigate = useNavigate();\n  const [loading, setLoading] = useState(true);\n  const [downloading, setDownloading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [shareInfo, setShareInfo] = useState(null);\n  const [password, setPassword] = useState('');\n  const [passwordRequired, setPasswordRequired] = useState(false);\n  const [error, setError] = useState('');\n  const [showSaveModal, setShowSaveModal] = useState(false);\n  const [showFolderSelector, setShowFolderSelector] = useState(false);\n\n  useEffect(() => {\n    fetchShareInfo();\n  }, [shareCode]);\n\n  const fetchShareInfo = async (pwd = '') => {\n    try {\n      setLoading(true);\n      setError('');\n      \n      const response = await api.get(`/api/files/share/${shareCode}/`, {\n        params: pwd ? { password: pwd } : {}\n      });\n      \n      setShareInfo(response.data);\n      setPasswordRequired(false);\n    } catch (error) {\n      if (error.response?.status === 403 && error.response?.data?.error === '需要密码') {\n        setPasswordRequired(true);\n      } else if (error.response?.status === 404) {\n        setError('分享链接不存在或已过期');\n      } else {\n        setError(error.response?.data?.error || '获取分享信息失败');\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handlePasswordSubmit = () => {\n    if (!password.trim()) {\n      message.error('请输入密码');\n      return;\n    }\n    fetchShareInfo(password);\n  };\n\n  const handleDownload = async () => {\n    try {\n      setDownloading(true);\n      \n      const response = await api.post(`/api/files/share/${shareCode}/download/`, \n        passwordRequired ? { password } : {},\n        {\n          responseType: 'blob'\n        }\n      );\n\n      // 创建下载链接\n      const blob = new Blob([response.data]);\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      \n      // 从响应头获取文件名\n      const contentDisposition = response.headers['content-disposition'];\n      let filename = shareInfo?.file_name || 'download';\n      if (contentDisposition) {\n        const filenameMatch = contentDisposition.match(/filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/);\n        if (filenameMatch && filenameMatch[1]) {\n          filename = filenameMatch[1].replace(/['\"]/g, '');\n        }\n      }\n      \n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n\n      message.success('文件下载成功！');\n      \n      // 更新下载次数\n      if (shareInfo) {\n        setShareInfo({\n          ...shareInfo,\n          download_count: shareInfo.download_count + 1\n        });\n      }\n    } catch (error) {\n      message.error(error.response?.data?.error || '下载失败');\n    } finally {\n      setDownloading(false);\n    }\n  };\n\n  const formatFileSize = (bytes) => {\n    if (!bytes) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const formatDate = (dateString) => {\n    if (!dateString) return null;\n    return new Date(dateString).toLocaleString('zh-CN');\n  };\n\n  const handleSaveToCloud = async (folderId = null) => {\n    try {\n      setSaving(true);\n      \n      const saveData = {\n        share_code: shareCode,\n        folder_id: folderId,\n        password: passwordRequired ? password : undefined\n      };\n\n      const response = await api.post('/api/files/save-shared-file/', saveData);\n      \n      message.success('文件已保存到您的云盘！');\n      setShowSaveModal(false);\n      \n      // 询问是否跳转到文件管理页面\n      setTimeout(() => {\n        if (window.confirm('文件已保存成功！是否前往文件管理页面查看？')) {\n          navigate('/login');\n        }\n      }, 1000);\n      \n    } catch (error) {\n      if (error.response?.status === 401) {\n        message.error('请先登录后再保存文件到云盘');\n        navigate('/login');\n      } else {\n        message.error(error.response?.data?.error || '保存到云盘失败');\n      }\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleFolderSelect = (folderId) => {\n    setShowFolderSelector(false);\n    handleSaveToCloud(folderId);\n  };\n\n  const renderSaveModal = () => {\n    return (\n      <Modal\n        title={\n          <Space>\n            <CloudUploadOutlined />\n            保存到云盘\n          </Space>\n        }\n        open={showSaveModal}\n        onCancel={() => setShowSaveModal(false)}\n        footer={null}\n        width={500}\n      >\n        <Alert\n          message={`将文件 \"${shareInfo?.file_name}\" 保存到您的云盘`}\n          type=\"info\"\n          showIcon\n          style={{ marginBottom: 20 }}\n        />\n        \n        <Space direction=\"vertical\" style={{ width: '100%' }}>\n          <Button \n            block \n            icon={<SaveOutlined />}\n            onClick={() => handleSaveToCloud(null)}\n            loading={saving}\n          >\n            保存到根目录\n          </Button>\n          \n          <Button \n            block \n            icon={<FolderOutlined />}\n            onClick={() => {\n              setShowSaveModal(false);\n              setShowFolderSelector(true);\n            }}\n            loading={saving}\n          >\n            选择文件夹保存\n          </Button>\n          \n          <Button onClick={() => setShowSaveModal(false)}>\n            取消\n          </Button>\n        </Space>\n      </Modal>\n    );\n  };\n\n  if (loading) {\n    return (\n      <div style={{ \n        display: 'flex', \n        justifyContent: 'center', \n        alignItems: 'center', \n        minHeight: '60vh' \n      }}>\n        <Spin size=\"large\" tip=\"加载中...\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div style={{ maxWidth: 600, margin: '50px auto' }}>\n        <Alert\n          message=\"访问失败\"\n          description={error}\n          type=\"error\"\n          showIcon\n          action={\n            <Button type=\"primary\" onClick={() => navigate('/login')}>\n              返回登录\n            </Button>\n          }\n        />\n      </div>\n    );\n  }\n\n  if (passwordRequired && !shareInfo) {\n    return (\n      <div style={{ maxWidth: 400, margin: '100px auto' }}>\n        <Card>\n          <Title level={3} style={{ textAlign: 'center', marginBottom: 30 }}>\n            <LockOutlined /> 访问受保护的分享\n          </Title>\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\n            <Input.Password\n              placeholder=\"请输入访问密码\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              onPressEnter={handlePasswordSubmit}\n            />\n            <Button \n              type=\"primary\" \n              block \n              onClick={handlePasswordSubmit}\n              loading={loading}\n            >\n              解锁访问\n            </Button>\n          </Space>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div style={{ maxWidth: 800, margin: '50px auto', padding: '0 20px' }}>\n      <Card>\n        <div style={{ textAlign: 'center', marginBottom: 30 }}>\n          <FileOutlined style={{ fontSize: 64, color: '#1890ff', marginBottom: 16 }} />\n          <Title level={2}>{shareInfo?.file_name || '未知文件'}</Title>\n        </div>\n\n        <Descriptions column={1} bordered style={{ marginBottom: 30 }}>\n          <Descriptions.Item label=\"文件大小\">\n            <Tag color=\"blue\">{formatFileSize(shareInfo.file_size)}</Tag>\n          </Descriptions.Item>\n          \n          <Descriptions.Item label=\"下载次数\">\n            <Space>\n              <NumberOutlined />\n              <Text strong>\n                {shareInfo.download_count} / {shareInfo.max_downloads || '无限制'}\n              </Text>\n            </Space>\n          </Descriptions.Item>\n\n          {shareInfo.expire_at && (\n            <Descriptions.Item label=\"过期时间\">\n              <Space>\n                <ClockCircleOutlined />\n                <Text type={new Date(shareInfo.expire_at) < new Date() ? 'danger' : 'success'}>\n                  {formatDate(shareInfo.expire_at)}\n                </Text>\n              </Space>\n            </Descriptions.Item>\n          )}\n\n          {shareInfo.password_protected && (\n            <Descriptions.Item label=\"访问保护\">\n              <Tag color=\"orange\"><LockOutlined /> 密码保护</Tag>\n            </Descriptions.Item>\n          )}\n\n          <Descriptions.Item label=\"分享时间\">\n            {formatDate(shareInfo.created_at)}\n          </Descriptions.Item>\n        </Descriptions>\n\n        <div style={{ textAlign: 'center' }}>\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\n            <Button\n              type=\"primary\"\n              size=\"large\"\n              icon={<DownloadOutlined />}\n              onClick={handleDownload}\n              loading={downloading}\n              disabled={\n                shareInfo.max_downloads > 0 && \n                shareInfo.download_count >= shareInfo.max_downloads\n              }\n              block\n            >\n              {shareInfo.max_downloads > 0 && \n               shareInfo.download_count >= shareInfo.max_downloads\n                ? '下载次数已用完'\n                : '直接下载到本地'\n              }\n            </Button>\n            \n            <Button\n              size=\"large\"\n              icon={<CloudUploadOutlined />}\n              onClick={() => setShowSaveModal(true)}\n              loading={saving}\n              block\n            >\n              保存到云盘\n            </Button>\n          </Space>\n        </div>\n\n        <div style={{ textAlign: 'center', marginTop: 20 }}>\n          <Button type=\"link\" onClick={() => navigate('/login')}>\n            返回登录页面\n          </Button>\n        </div>\n      </Card>\n      \n      {renderSaveModal()}\n      \n      <FolderSelector\n        visible={showFolderSelector}\n        onCancel={() => setShowFolderSelector(false)}\n        onConfirm={handleFolderSelect}\n        loading={saving}\n      />\n    </div>\n  );\n};\n\nexport default ShareView;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}