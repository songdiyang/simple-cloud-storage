(this["webpackJsonpcloud-storage-frontend"]=this["webpackJsonpcloud-storage-frontend"]||[]).push([[0],{267:function(e,t,a){},275:function(e,t,a){},285:function(e,t,a){"use strict";a.r(t);var s=a(0),c=a.n(s),r=a(231),n=a.n(r),l=a(102),i=a(63),o=a(23),d=a(243),j=a.n(d),b=a(57),x=a.n(b),h=(a(266),a(20)),p=a(319),u=a(321),O=(a(267),a(311));const m=a(304).a.create({baseURL:"http://localhost:8000",headers:{"Content-Type":"application/json"}});m.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Token ".concat(t)),e},e=>Promise.reject(e)),m.interceptors.response.use(e=>e,e=>{var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)});var g=m,y=a(7);const f=Object(s.createContext)(),v=()=>{const e=Object(s.useContext)(f);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},w=e=>{let{children:t}=e;const[a,c]=Object(s.useState)(null),[r,n]=Object(s.useState)(!0);Object(s.useEffect)(()=>{const e=localStorage.getItem("token");e?(g.defaults.headers.common.Authorization="Token ".concat(e),l()):n(!1)},[]);const l=async()=>{try{const e=await g.get("/api/auth/profile/");c(e.data)}catch(e){console.error("Failed to fetch user:",e),localStorage.removeItem("token"),delete g.defaults.headers.common.Authorization}finally{n(!1)}},i={user:a,login:async e=>{try{const t=await g.post("/api/auth/login/",e),{token:a,user:s}=t.data;return localStorage.setItem("token",a),g.defaults.headers.common.Authorization="Token ".concat(a),c(s),O.a.success("\u767b\u5f55\u6210\u529f\uff01"),{success:!0}}catch(s){var t,a;const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"\u767b\u5f55\u5931\u8d25";return O.a.error(e),{success:!1,error:e}}},register:async e=>{try{const t=await g.post("/api/auth/register/",e),{token:a,user:s}=t.data;return localStorage.setItem("token",a),g.defaults.headers.common.Authorization="Token ".concat(a),c(s),O.a.success("\u6ce8\u518c\u6210\u529f\uff01"),{success:!0}}catch(a){var t;const e=null===(t=a.response)||void 0===t?void 0:t.data;let s="\u6ce8\u518c\u5931\u8d25";return e&&("string"===typeof e?s=e:e.non_field_errors?s=e.non_field_errors[0]:e.username?s=e.username[0]:e.email&&(s=e.email[0])),O.a.error(s),{success:!1,error:s}}},logout:async()=>{try{await g.post("/api/auth/logout/")}catch(e){console.error("Logout error:",e)}finally{localStorage.removeItem("token"),delete g.defaults.headers.common.Authorization,c(null),O.a.success("\u5df2\u9000\u51fa\u767b\u5f55")}},updateProfile:async e=>{try{const t=await g.put("/api/auth/profile/",e);return c(t.data),O.a.success("\u8d44\u6599\u66f4\u65b0\u6210\u529f\uff01"),{success:!0}}catch(s){var t,a;const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"\u66f4\u65b0\u5931\u8d25";return O.a.error(e),{success:!1,error:e}}},loading:r};return Object(y.jsx)(f.Provider,{value:i,children:t})};var k=a(307),_=a(316),C=a(61),S=a(305),I=a(308),T=a(312),z=a(322),B=a(323);const{Title:R,Text:F}=k.a;var N=()=>{const[e,t]=Object(s.useState)(!1),[a,c]=Object(s.useState)({checking:!0,online:!1}),{login:r}=v(),n=Object(h.q)();Object(s.useEffect)(()=>{(async()=>{try{await g.get("/api/auth/",{timeout:5e3});c({checking:!1,online:!0})}catch(e){c({checking:!1,online:!1}),console.warn("API\u8fde\u63a5\u68c0\u67e5\u5931\u8d25:",e.message)}})()},[]);const i=async()=>{try{await g.get("/api/auth/",{timeout:5e3}),c({checking:!1,online:!0})}catch(e){c({checking:!1,online:!1})}};return Object(y.jsxs)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",padding:"20px",background:"#f0f2f5",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:[!a.checking&&!a.online&&Object(y.jsx)("div",{style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",zIndex:1e3,width:"90%",maxWidth:"400px"},children:Object(y.jsx)(_.a,{message:"\u670d\u52a1\u8fde\u63a5\u5931\u8d25",description:"\u65e0\u6cd5\u8fde\u63a5\u5230\u670d\u52a1\u5668\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u6216\u7a0d\u540e\u91cd\u8bd5\u3002",type:"error",showIcon:!0,closable:!1,action:Object(y.jsx)(C.a,{size:"small",onClick:()=>{c({checking:!0,online:!1}),setTimeout(()=>{i()},1e3)},children:"\u91cd\u8bd5"}),style:{borderRadius:"8px"}})}),Object(y.jsxs)(S.a,{style:{width:"100%",maxWidth:"360px",padding:"40px 32px",border:"1px solid #d9d9d9",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.08)"},bodyStyle:{padding:0},children:[Object(y.jsxs)("div",{style:{textAlign:"center",marginBottom:"32px"},children:[Object(y.jsx)("div",{style:{width:"64px",height:"64px",background:"#1890ff",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"28px",margin:"0 auto 20px"},children:Object(y.jsx)(u.a,{})}),Object(y.jsx)(R,{level:3,style:{color:"#262626",margin:"0 0 8px 0",fontSize:"24px",fontWeight:600},children:"\u767b\u5f55"}),Object(y.jsx)(F,{style:{color:"#8c8c8c",fontSize:"14px"},children:"\u6b22\u8fce\u4f7f\u7528\u4e91\u5b58\u50a8\u7cfb\u7edf"})]}),Object(y.jsxs)(I.a,{name:"login",onFinish:async e=>{t(!0);try{(await r(e)).success&&(O.a.success("\u767b\u5f55\u6210\u529f\uff01\u6b63\u5728\u8df3\u8f6c..."),setTimeout(()=>n("/dashboard"),1e3))}finally{t(!1)}},layout:"vertical",size:"large",style:{marginTop:"24px"},children:[Object(y.jsx)(I.a.Item,{name:"username",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"}],style:{marginBottom:"16px"},children:Object(y.jsx)(T.a,{prefix:Object(y.jsx)(z.a,{style:{color:"#8c8c8c"}}),placeholder:"\u7528\u6237\u540d",style:{height:"40px",border:"1px solid #d9d9d9",borderRadius:"6px"}})}),Object(y.jsx)(I.a.Item,{name:"password",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801"}],style:{marginBottom:"24px"},children:Object(y.jsx)(T.a.Password,{prefix:Object(y.jsx)(B.a,{style:{color:"#8c8c8c"}}),placeholder:"\u5bc6\u7801",style:{height:"40px",border:"1px solid #d9d9d9",borderRadius:"6px"}})}),Object(y.jsx)(I.a.Item,{style:{marginBottom:"16px"},children:Object(y.jsx)(C.a,{type:"primary",htmlType:"submit",loading:e,disabled:!a.online&&!a.checking,block:!0,style:{height:"40px",fontSize:"16px",fontWeight:500,backgroundColor:"#1890ff",borderColor:"#1890ff",borderRadius:"6px"},children:e?"\u767b\u5f55\u4e2d...":"\u767b\u5f55"})})]}),Object(y.jsx)("div",{style:{textAlign:"center",borderTop:"1px solid #f0f0f0",paddingTop:"16px",marginTop:"16px"},children:Object(y.jsxs)(F,{style:{color:"#8c8c8c",fontSize:"14px"},children:["\u8fd8\u6ca1\u6709\u8d26\u53f7\uff1f"," ",Object(y.jsx)(l.b,{to:"/register",style:{color:"#1890ff",textDecoration:"none",fontWeight:500},children:"\u7acb\u5373\u6ce8\u518c"})]})})]})]})},L=a(324);const{Title:M,Text:E}=k.a;var A=()=>{const[e,t]=Object(s.useState)(!1),{register:a}=v(),c=Object(h.q)();return Object(y.jsx)("div",{className:"cel-gradient-bg",style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",padding:"20px"},children:Object(y.jsx)("div",{className:"cel-float",children:Object(y.jsxs)(S.a,{style:{width:"100%",maxWidth:"400px",padding:"20px",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"20px"},children:[Object(y.jsxs)("div",{style:{textAlign:"center",marginBottom:"32px"},children:[Object(y.jsx)("div",{style:{width:"80px",height:"80px",background:"linear-gradient(145deg, #667eea, #764ba2)",borderRadius:"20px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"36px",fontWeight:"bold",margin:"0 auto 16px"},children:Object(y.jsx)(u.a,{})}),Object(y.jsx)(M,{level:2,style:{color:"#333",margin:0},children:"\u521b\u5efa\u8d26\u53f7"}),Object(y.jsx)(E,{type:"secondary",children:"\u5f00\u59cb\u60a8\u7684\u4e91\u5b58\u50a8\u4e4b\u65c5"})]}),Object(y.jsxs)(I.a,{name:"register",onFinish:async e=>{t(!0);const s=await a(e);t(!1),s.success&&c("/dashboard")},layout:"vertical",size:"large",children:[Object(y.jsx)(I.a.Item,{name:"username",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"}],children:Object(y.jsx)(T.a,{prefix:Object(y.jsx)(z.a,{}),placeholder:"\u7528\u6237\u540d",className:"cel-input"})}),Object(y.jsx)(I.a.Item,{name:"email",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u90ae\u7bb1"},{type:"email",message:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u90ae\u7bb1\u5730\u5740"}],children:Object(y.jsx)(T.a,{prefix:Object(y.jsx)(L.a,{}),placeholder:"\u90ae\u7bb1",className:"cel-input"})}),Object(y.jsx)(I.a.Item,{name:"password",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801"},{min:8,message:"\u5bc6\u7801\u81f3\u5c118\u4e2a\u5b57\u7b26"}],children:Object(y.jsx)(T.a.Password,{prefix:Object(y.jsx)(B.a,{}),placeholder:"\u5bc6\u7801",className:"cel-input"})}),Object(y.jsx)(I.a.Item,{name:"password_confirm",dependencies:["password"],rules:[{required:!0,message:"\u8bf7\u786e\u8ba4\u5bc6\u7801"},e=>{let{getFieldValue:t}=e;return{validator:(e,a)=>a&&t("password")!==a?Promise.reject(new Error("\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4")):Promise.resolve()}}],children:Object(y.jsx)(T.a.Password,{prefix:Object(y.jsx)(B.a,{}),placeholder:"\u786e\u8ba4\u5bc6\u7801",className:"cel-input"})}),Object(y.jsx)(I.a.Item,{children:Object(y.jsx)(C.a,{type:"primary",htmlType:"submit",loading:e,block:!0,className:"cel-button",style:{height:"48px",fontSize:"16px",fontWeight:"bold"},children:"\u6ce8\u518c"})}),Object(y.jsx)("div",{style:{textAlign:"center"},children:Object(y.jsxs)(E,{type:"secondary",children:["\u5df2\u6709\u8d26\u53f7\uff1f"," ",Object(y.jsx)(l.b,{to:"/login",style:{color:"#667eea",fontWeight:"bold"},children:"\u7acb\u5373\u767b\u5f55"})]})})]})]})})})},P=a(297),W=a(298),Q=a(314),q=a(245),U=a(244),D=a(208),H=a(251),Y=a(325);const{Title:K,Text:G}=k.a;var J=()=>{const{data:e}=Object(i.useQuery)("storage-info",()=>g.get("/api/files/storage/").then(e=>e.data)),t=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]};return Object(y.jsxs)("div",{children:[Object(y.jsx)(K,{level:2,style:{color:"#333",marginBottom:"24px"},children:"\u4eea\u8868\u76d8"}),Object(y.jsxs)(P.a,{gutter:[24,24],children:[Object(y.jsx)(W.a,{xs:24,sm:12,lg:6,children:Object(y.jsx)(S.a,{className:"modern-card",children:Object(y.jsx)(Q.a,{title:"\u5b58\u50a8\u914d\u989d",value:(null===e||void 0===e?void 0:e.storage_quota)||0,formatter:e=>t(e),prefix:Object(y.jsx)(u.a,{style:{color:"#1890ff"}})})})}),Object(y.jsx)(W.a,{xs:24,sm:12,lg:6,children:Object(y.jsx)(S.a,{className:"modern-card",children:Object(y.jsx)(Q.a,{title:"\u5df2\u4f7f\u7528\u5b58\u50a8",value:(null===e||void 0===e?void 0:e.used_storage)||0,formatter:e=>t(e),prefix:Object(y.jsx)(D.a,{style:{color:"#52c41a"}})})})}),Object(y.jsx)(W.a,{xs:24,sm:12,lg:6,children:Object(y.jsx)(S.a,{className:"modern-card",children:Object(y.jsx)(Q.a,{title:"\u6587\u4ef6\u603b\u6570",value:(null===e||void 0===e?void 0:e.total_files)||0,prefix:Object(y.jsx)(D.a,{style:{color:"#722ed1"}})})})}),Object(y.jsx)(W.a,{xs:24,sm:12,lg:6,children:Object(y.jsx)(S.a,{className:"modern-card",children:Object(y.jsx)(Q.a,{title:"\u6587\u4ef6\u5939\u603b\u6570",value:(null===e||void 0===e?void 0:e.total_folders)||0,prefix:Object(y.jsx)(H.a,{style:{color:"#fa8c16"}})})})})]}),Object(y.jsxs)(P.a,{gutter:[24,24],style:{marginTop:"24px"},children:[Object(y.jsx)(W.a,{xs:24,lg:12,children:Object(y.jsx)(S.a,{className:"modern-card",title:"\u5b58\u50a8\u4f7f\u7528\u60c5\u51b5",children:Object(y.jsxs)(q.a,{direction:"vertical",style:{width:"100%"},children:[Object(y.jsxs)("div",{children:[Object(y.jsx)(G,{strong:!0,children:"\u603b\u4f53\u4f7f\u7528\u7387"}),Object(y.jsx)(U.a,{percent:(null===e||void 0===e?void 0:e.storage_usage_percentage)||0,strokeColor:{"0%":"#1890ff","100%":"#52c41a"},format:e=>"".concat(null===e||void 0===e?void 0:e.toFixed(1),"%"),className:"progress-custom"})]}),Object(y.jsx)("div",{children:Object(y.jsxs)(G,{type:"secondary",children:["\u5df2\u4f7f\u7528: ",t((null===e||void 0===e?void 0:e.used_storage)||0)," /",t((null===e||void 0===e?void 0:e.storage_quota)||0)]})}),Object(y.jsx)("div",{children:Object(y.jsxs)(G,{type:"secondary",children:["\u53ef\u7528\u7a7a\u95f4: ",t((null===e||void 0===e?void 0:e.available_storage)||0)]})})]})})}),Object(y.jsx)(W.a,{xs:24,lg:12,children:Object(y.jsx)(S.a,{className:"modern-card",title:"\u5feb\u901f\u64cd\u4f5c",children:Object(y.jsxs)(q.a,{direction:"vertical",style:{width:"100%"},children:[Object(y.jsx)("div",{style:{padding:"16px",background:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:"6px",cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>window.location.href="/files",onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#d9f7be"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#f6ffed"},children:Object(y.jsxs)(q.a,{children:[Object(y.jsx)(H.a,{style:{fontSize:"20px",color:"#52c41a"}}),Object(y.jsxs)("div",{children:[Object(y.jsx)(G,{strong:!0,children:"\u7ba1\u7406\u6587\u4ef6"}),Object(y.jsx)("br",{}),Object(y.jsx)(G,{type:"secondary",style:{fontSize:"12px"},children:"\u6d4f\u89c8\u548c\u7ba1\u7406\u60a8\u7684\u6587\u4ef6"})]})]})}),Object(y.jsx)("div",{style:{padding:"16px",background:"#e6f7ff",border:"1px solid #91d5ff",borderRadius:"6px",cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>window.location.href="/shares",onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#bae7ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#e6f7ff"},children:Object(y.jsxs)(q.a,{children:[Object(y.jsx)(Y.a,{style:{fontSize:"20px",color:"#1890ff"}}),Object(y.jsxs)("div",{children:[Object(y.jsx)(G,{strong:!0,children:"\u5206\u4eab\u6587\u4ef6"}),Object(y.jsx)("br",{}),Object(y.jsx)(G,{type:"secondary",style:{fontSize:"12px"},children:"\u521b\u5efa\u548c\u7ba1\u7406\u5206\u4eab\u94fe\u63a5"})]})]})})]})})})]})]})},V=a(3),X=a(306),Z=a(318),$=a(66),ee=a(315),te=a(302),ae=a(310),se=a(253),ce=a(327),re=a(328),ne=a(329),le=a(330),ie=a(320),oe=a(303),de=a(309),je=a(252),be=a(326),xe=a(250);const{Title:he,Text:pe}=k.a;var ue=e=>{let{visible:t,onCancel:a,file:c,onSuccess:r}=e;const[n]=I.a.useForm(),[l,i]=Object(s.useState)(!1),[o,d]=Object(s.useState)(""),[j,b]=Object(s.useState)(!1),h=()=>{n.resetFields(),d(""),b(!1),a()};return Object(y.jsx)(ae.a,{title:Object(y.jsxs)(q.a,{children:[Object(y.jsx)(Y.a,{}),"\u521b\u5efa\u6587\u4ef6\u5206\u4eab"]}),open:t,onCancel:h,footer:null,width:600,children:j?Object(y.jsxs)("div",{style:{textAlign:"center"},children:[Object(y.jsxs)(he,{level:4,children:[Object(y.jsx)(Y.a,{})," \u5206\u4eab\u521b\u5efa\u6210\u529f\uff01"]}),Object(y.jsx)("div",{style:{background:"#f5f5f5",padding:15,borderRadius:8,margin:"20px 0",wordBreak:"break-all"},children:Object(y.jsx)(pe,{copyable:{text:o},children:o})}),Object(y.jsxs)(q.a,{children:[Object(y.jsx)(C.a,{type:"primary",icon:Object(y.jsx)(xe.a,{}),onClick:()=>{navigator.clipboard.writeText(o),O.a.success("\u94fe\u63a5\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f")},children:"\u590d\u5236\u94fe\u63a5"}),Object(y.jsx)(C.a,{onClick:h,children:"\u5173\u95ed"})]}),Object(y.jsx)(_.a,{message:"\u5206\u4eab\u63d0\u793a",description:"\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u901a\u8fc7\u6b64\u94fe\u63a5\u8bbf\u95ee\u6587\u4ef6\uff0c\u8bf7\u8c28\u614e\u5206\u4eab\u3002\u5982\u9700\u53d6\u6d88\u5206\u4eab\uff0c\u8bf7\u5728'\u6211\u7684\u5206\u4eab'\u9875\u9762\u4e2d\u5220\u9664\u3002",type:"warning",showIcon:!0,style:{marginTop:20}})]}):Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(_.a,{message:"\u5206\u4eab\u6587\u4ef6: ".concat(null===c||void 0===c?void 0:c.name),type:"info",showIcon:!0,style:{marginBottom:20}}),Object(y.jsxs)(I.a,{form:n,layout:"vertical",onFinish:async e=>{try{i(!0);const t={password:e.password||void 0,expire_at:e.expire_at?e.expire_at.toISOString():void 0,max_downloads:e.max_downloads||void 0},a=await g.post("/api/files/".concat(c.id,"/share/"),t),s="".concat(window.location.origin,"/share/").concat(a.data.share_code);d(s),b(!0),O.a.success("\u5206\u4eab\u521b\u5efa\u6210\u529f\uff01"),null===r||void 0===r||r()}catch(s){var t,a;O.a.error((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"\u521b\u5efa\u5206\u4eab\u5931\u8d25")}finally{i(!1)}},children:[Object(y.jsx)(I.a.Item,{name:"password",label:Object(y.jsxs)(q.a,{children:[Object(y.jsx)(B.a,{}),"\u8bbf\u95ee\u5bc6\u7801\uff08\u53ef\u9009\uff09"]}),help:"\u7559\u7a7a\u5219\u65e0\u9700\u5bc6\u7801\u5373\u53ef\u8bbf\u95ee",children:Object(y.jsx)(T.a.Password,{placeholder:"\u8bbe\u7f6e\u8bbf\u95ee\u5bc6\u7801"})}),Object(y.jsx)(ie.a,{}),Object(y.jsx)(I.a.Item,{name:"expire_at",label:Object(y.jsxs)(q.a,{children:[Object(y.jsx)(je.a,{}),"\u8fc7\u671f\u65f6\u95f4\uff08\u53ef\u9009\uff09"]}),help:"\u7559\u7a7a\u5219\u6c38\u4e0d\u8fc7\u671f",children:Object(y.jsx)(oe.a,{showTime:!0,placeholder:"\u9009\u62e9\u8fc7\u671f\u65f6\u95f4",disabledDate:e=>e&&e<x()().startOf("day"),style:{width:"100%"}})}),Object(y.jsx)(I.a.Item,{name:"max_downloads",label:Object(y.jsxs)(q.a,{children:[Object(y.jsx)(be.a,{}),"\u6700\u5927\u4e0b\u8f7d\u6b21\u6570\uff08\u53ef\u9009\uff09"]}),help:"\u7559\u7a7a\u5219\u65e0\u9650\u5236",children:Object(y.jsx)(de.a,{placeholder:"\u8bbe\u7f6e\u6700\u5927\u4e0b\u8f7d\u6b21\u6570",min:1,style:{width:"100%"}})}),Object(y.jsx)(ie.a,{}),Object(y.jsx)(I.a.Item,{children:Object(y.jsxs)(q.a,{style:{width:"100%",justifyContent:"flex-end"},children:[Object(y.jsx)(C.a,{onClick:h,children:"\u53d6\u6d88"}),Object(y.jsx)(C.a,{type:"primary",htmlType:"submit",loading:l,icon:Object(y.jsx)(Y.a,{}),children:"\u521b\u5efa\u5206\u4eab"})]})})]})]})})};const{Title:Oe,Text:me}=k.a,{Dragger:ge}=X.a;var ye=()=>{const{folderId:e}=Object(h.s)(),t=Object(h.q)(),a=Object(i.useQueryClient)(),[c,r]=Object(s.useState)(!1),[n,l]=Object(s.useState)(!1),[o]=I.a.useForm(),{data:d=[]}=Object(i.useQuery)(["folders",e],()=>g.get("/api/files/folders/",{params:e?{parent_id:e}:{}}).then(e=>e.data)),{data:j,isLoading:b}=Object(i.useQuery)(["files",e],()=>g.get("/api/files/",{params:e?{folder_id:e}:{}}).then(e=>e.data),{refetchOnWindowFocus:!1}),x=Object(i.useMutation)(t=>{const a=new FormData;return a.append("file",t),e&&a.append("folder_id",e),g.post("/api/files/upload/",a,{headers:{"Content-Type":void 0}})},{onSuccess:()=>{O.a.success("\u6587\u4ef6\u4e0a\u4f20\u6210\u529f\uff01"),r(!1),a.invalidateQueries("files"),a.invalidateQueries("storage-info")},onError:e=>{var t,a;const s=(null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"\u4e0a\u4f20\u5931\u8d25";O.a.error(s)}}),p=Object(i.useMutation)(t=>g.post("/api/files/folders/create/",Object(V.a)(Object(V.a)({},t),{},{parent_id:e})),{onSuccess:()=>{O.a.success("\u6587\u4ef6\u5939\u521b\u5efa\u6210\u529f\uff01"),l(!1),o.resetFields(),a.invalidateQueries("folders")},onError:e=>{var t,a;const s=(null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"\u521b\u5efa\u5931\u8d25";O.a.error(s)}}),u=Object(i.useMutation)(e=>g.delete("/api/files/".concat(e,"/delete/")),{onSuccess:()=>{O.a.success("\u6587\u4ef6\u5220\u9664\u6210\u529f\uff01"),a.invalidateQueries("files"),a.invalidateQueries("storage-info")},onError:e=>{var t,a;const s=(null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"\u5220\u9664\u5931\u8d25";O.a.error(s)}}),m=Object(i.useMutation)(e=>g.delete("/api/files/folders/".concat(e,"/delete/")),{onSuccess:()=>{O.a.success("\u6587\u4ef6\u5939\u5220\u9664\u6210\u529f\uff01"),a.invalidateQueries("folders")},onError:e=>{var t,a;const s=(null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"\u5220\u9664\u5931\u8d25";O.a.error(s)}}),f={name:"file",multiple:!1,customRequest:e=>{let{file:t,onSuccess:a,onError:s}=e;x.mutate(t,{onSuccess:()=>a(),onError:e=>s(e)})},showUploadList:!1},v=[{title:"\u540d\u79f0",dataIndex:"name",key:"name",render:(e,a)=>Object(y.jsxs)(q.a,{children:[Object(y.jsx)(H.a,{style:{color:"#fa709a",fontSize:"18px"}}),Object(y.jsx)(C.a,{type:"link",onClick:()=>t("/files/".concat(a.id)),style:{padding:0,height:"auto"},children:e})]})},{title:"\u6587\u4ef6\u6570\u91cf",dataIndex:"files_count",key:"files_count"},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created_at",key:"created_at",render:e=>new Date(e).toLocaleString()},{title:"\u64cd\u4f5c",key:"actions",render:(e,t)=>Object(y.jsx)(q.a,{children:Object(y.jsx)(Z.a,{title:"\u786e\u5b9a\u5220\u9664\u8fd9\u4e2a\u6587\u4ef6\u5939\u5417\uff1f",onConfirm:()=>m.mutate(t.id),okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:Object(y.jsx)(C.a,{type:"text",danger:!0,icon:Object(y.jsx)(se.a,{}),size:"small"})})})}],w=[{title:"\u540d\u79f0",dataIndex:"name",key:"name",render:(e,t)=>Object(y.jsxs)(q.a,{children:[Object(y.jsx)(D.a,{style:{color:k(t.file_extension),fontSize:"18px"}}),Object(y.jsx)($.a,{title:t.original_name,children:Object(y.jsx)(me,{ellipsis:!0,style:{maxWidth:"200px"},children:e})})]})},{title:"\u5927\u5c0f",dataIndex:"size_display",key:"size_display"},{title:"\u7c7b\u578b",dataIndex:"file_type",key:"file_type",render:e=>Object(y.jsx)(ee.a,{color:"blue",children:e||"\u672a\u77e5"})},{title:"\u4e0a\u4f20\u65f6\u95f4",dataIndex:"created_at",key:"created_at",render:e=>new Date(e).toLocaleString()},{title:"\u64cd\u4f5c",key:"actions",render:(e,t)=>Object(y.jsxs)(q.a,{children:[Object(y.jsx)($.a,{title:"\u4e0b\u8f7d\u6587\u4ef6",children:Object(y.jsx)(C.a,{type:"text",icon:Object(y.jsx)(ce.a,{}),size:"small",onClick:()=>(async e=>{try{O.a.loading("\u6b63\u5728\u51c6\u5907\u4e0b\u8f7d...",0);const t=await g.get("/api/files/".concat(e.id,"/download-url/")),{download_url:a,filename:s,method:c}=t.data;if("direct"===c){O.a.destroy(),O.a.loading("\u6b63\u5728\u4e0b\u8f7d\u6587\u4ef6...",0);const t=await g.get("/api/files/".concat(e.id,"/download/"),{responseType:"blob"}),a=new Blob([t.data],{type:e.mime_type}),c=window.URL.createObjectURL(a),r=document.createElement("a");r.href=c,r.download=s,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(c),O.a.destroy(),O.a.success("\u6587\u4ef6\u4e0b\u8f7d\u5b8c\u6210\uff01")}else{const e=document.createElement("a");e.href=a,e.download=s,e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),O.a.destroy(),O.a.success("\u6587\u4ef6\u4e0b\u8f7d\u5f00\u59cb\uff01")}}catch(s){O.a.destroy();try{O.a.loading("\u6b63\u5728\u4e0b\u8f7d\u6587\u4ef6...",0);const t=await g.get("/api/files/".concat(e.id,"/download/"),{responseType:"blob"}),a=new Blob([t.data],{type:e.mime_type}),s=window.URL.createObjectURL(a),c=document.createElement("a");c.href=s,c.download=e.original_name,c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(s),O.a.destroy(),O.a.success("\u6587\u4ef6\u4e0b\u8f7d\u5b8c\u6210\uff01")}catch(c){var t,a;O.a.destroy();const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||c.message||"\u4e0b\u8f7d\u5931\u8d25";O.a.error("\u4e0b\u8f7d\u5931\u8d25: ".concat(e))}}})(t)})}),Object(y.jsx)($.a,{title:"\u5206\u4eab\u6587\u4ef6",children:Object(y.jsx)(C.a,{type:"text",icon:Object(y.jsx)(Y.a,{}),size:"small",onClick:()=>F(t.id)})}),Object(y.jsx)(Z.a,{title:"\u786e\u5b9a\u5220\u9664\u8fd9\u4e2a\u6587\u4ef6\u5417\uff1f",onConfirm:()=>u.mutate(t.id),okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:Object(y.jsx)($.a,{title:"\u5220\u9664\u6587\u4ef6",children:Object(y.jsx)(C.a,{type:"text",danger:!0,icon:Object(y.jsx)(se.a,{}),size:"small"})})})]})}],k=e=>({".pdf":"#ff6b6b",".doc":"#4facfe",".xls":"#43e97b",".jpg":"#fa709a",".png":"#fee140",".mp4":"#30cfd0",".mp3":"#a8edea",".zip":"#ff9a9e"}[e]||"#667eea"),[_,z]=Object(s.useState)(!1),[B,R]=Object(s.useState)(null),F=e=>{R(e),z(!0)};return Object(y.jsxs)("div",{children:[Object(y.jsxs)("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Object(y.jsxs)(q.a,{children:[e&&Object(y.jsx)(C.a,{icon:Object(y.jsx)(re.a,{}),onClick:()=>t("/files"),children:"\u8fd4\u56de\u4e0a\u7ea7"}),Object(y.jsx)(Oe,{level:2,style:{color:"#333",margin:0},children:"\u6211\u7684\u6587\u4ef6"})]}),Object(y.jsxs)(q.a,{children:[Object(y.jsx)(C.a,{type:"primary",icon:Object(y.jsx)(ne.a,{}),onClick:()=>r(!0),className:"cel-button",children:"\u4e0a\u4f20\u6587\u4ef6"}),Object(y.jsx)(C.a,{icon:Object(y.jsx)(le.a,{}),onClick:()=>l(!0),className:"cel-button",children:"\u65b0\u5efa\u6587\u4ef6\u5939"})]})]}),Object(y.jsxs)(P.a,{gutter:[24,24],children:[Object(y.jsx)(W.a,{span:24,children:Object(y.jsx)(S.a,{className:"cel-card",title:"\u6587\u4ef6\u5939",children:Object(y.jsx)(te.a,{columns:v,dataSource:d,rowKey:"id",pagination:!1,size:"small"})})}),Object(y.jsx)(W.a,{span:24,children:Object(y.jsx)(S.a,{className:"cel-card",title:"\u6587\u4ef6",children:Object(y.jsx)(te.a,{columns:w,dataSource:(null===j||void 0===j?void 0:j.results)||j||[],rowKey:"id",loading:b,pagination:{total:null===j||void 0===j?void 0:j.count,pageSize:20,showSizeChanger:!1,showQuickJumper:!0},size:"small"})})})]}),Object(y.jsx)(ae.a,{title:"\u4e0a\u4f20\u6587\u4ef6",open:c,onCancel:()=>r(!1),footer:null,width:600,children:Object(y.jsxs)(ge,Object(V.a)(Object(V.a)({},f),{},{children:[Object(y.jsx)("p",{className:"ant-upload-drag-icon",children:Object(y.jsx)(ne.a,{style:{fontSize:"48px",color:"#667eea"}})}),Object(y.jsx)("p",{className:"ant-upload-text",children:"\u70b9\u51fb\u6216\u62d6\u62fd\u6587\u4ef6\u5230\u6b64\u533a\u57df\u4e0a\u4f20"}),Object(y.jsx)("p",{className:"ant-upload-hint",children:"\u652f\u6301\u5355\u4e2a\u6587\u4ef6\u4e0a\u4f20\uff0c\u6587\u4ef6\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7\u7cfb\u7edf\u9650\u5236"})]}))}),Object(y.jsx)(ae.a,{title:"\u65b0\u5efa\u6587\u4ef6\u5939",open:n,onOk:()=>o.submit(),onCancel:()=>l(!1),confirmLoading:p.isLoading,children:Object(y.jsx)(I.a,{form:o,layout:"vertical",onFinish:e=>p.mutate(e),children:Object(y.jsx)(I.a.Item,{name:"name",label:"\u6587\u4ef6\u5939\u540d\u79f0",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6587\u4ef6\u5939\u540d\u79f0"}],children:Object(y.jsx)(T.a,{placeholder:"\u8bf7\u8f93\u5165\u6587\u4ef6\u5939\u540d\u79f0"})})})}),Object(y.jsx)(ue,{visible:_,onCancel:()=>{z(!1),R(null)},onOk:e=>{z(!1),R(null),a.invalidateQueries("my-shares")},fileId:B})]})},fe=a(207),ve=a(249);const{Title:we,Text:ke}=k.a,{RangePicker:_e}=oe.a;var Ce=()=>{const e=Object(i.useQueryClient)(),[t,a]=Object(s.useState)(!1),[c]=I.a.useForm(),{data:r=[],isLoading:n}=Object(i.useQuery)("my-shares",()=>g.get("/api/files/shares/").then(e=>e.data)),l=Object(i.useMutation)(e=>g.post("/api/files/".concat(e,"/share/")),{onSuccess:()=>{O.a.success("\u5206\u4eab\u521b\u5efa\u6210\u529f\uff01"),a(!1),c.resetFields(),e.invalidateQueries("my-shares")},onError:e=>{var t,a;const s=(null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"\u521b\u5efa\u5931\u8d25";O.a.error(s)}}),o=Object(i.useMutation)(e=>g.delete("/api/files/shares/".concat(e,"/delete/")),{onSuccess:()=>{O.a.success("\u5206\u4eab\u5df2\u53d6\u6d88\uff01"),e.invalidateQueries("my-shares")},onError:e=>{var t,a;const s=(null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"\u53d6\u6d88\u5931\u8d25";O.a.error(s)}}),d=[{title:"\u6587\u4ef6\u540d",dataIndex:"file_name",key:"file_name",render:e=>Object(y.jsx)($.a,{title:e,children:Object(y.jsx)(ke,{ellipsis:!0,style:{maxWidth:"200px"},children:e})})},{title:"\u6587\u4ef6\u5927\u5c0f",dataIndex:"file_size_display",key:"file_size_display"},{title:"\u5206\u4eab\u7801",dataIndex:"share_code",key:"share_code",render:(e,t)=>Object(y.jsxs)(q.a,{children:[Object(y.jsx)(ee.a,{color:"blue",children:e}),Object(y.jsx)(C.a,{type:"text",size:"small",icon:Object(y.jsx)(xe.a,{}),onClick:()=>{navigator.clipboard.writeText("".concat(window.location.origin,"/share/").concat(e)),O.a.success("\u5206\u4eab\u94fe\u63a5\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f\uff01")}})]})},{title:"\u72b6\u6001",dataIndex:"is_active",key:"is_active",render:(e,t)=>Object(y.jsxs)(q.a,{direction:"vertical",size:"small",children:[Object(y.jsx)(ee.a,{color:e?"green":"red",children:e?"\u6709\u6548":"\u65e0\u6548"}),t.is_expired&&Object(y.jsx)(ee.a,{color:"orange",children:"\u5df2\u8fc7\u671f"})]})},{title:"\u4e0b\u8f7d\u6b21\u6570",dataIndex:"download_count",key:"download_count",render:(e,t)=>Object(y.jsxs)(ke,{children:[e," / ",t.max_downloads||"\u65e0\u9650\u5236"]})},{title:"\u8fc7\u671f\u65f6\u95f4",dataIndex:"expire_at",key:"expire_at",render:e=>e?x()(e).format("YYYY-MM-DD HH:mm"):"\u6c38\u4e0d\u8fc7\u671f"},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created_at",key:"created_at",render:e=>x()(e).format("YYYY-MM-DD HH:mm")},{title:"\u64cd\u4f5c",key:"actions",render:(e,t)=>Object(y.jsxs)(q.a,{children:[Object(y.jsx)(C.a,{type:"text",size:"small",icon:Object(y.jsx)(fe.a,{}),onClick:()=>window.open("/share/".concat(t.share_code),"_blank")}),Object(y.jsx)(Z.a,{title:"\u786e\u5b9a\u53d6\u6d88\u8fd9\u4e2a\u5206\u4eab\u5417\uff1f",onConfirm:()=>o.mutate(t.id),okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:Object(y.jsx)(C.a,{type:"text",danger:!0,size:"small",icon:Object(y.jsx)(se.a,{})})})]})}];return Object(y.jsxs)("div",{children:[Object(y.jsxs)("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Object(y.jsx)(we,{level:2,style:{color:"#333",margin:0},children:"\u6211\u7684\u5206\u4eab"}),Object(y.jsx)(C.a,{type:"primary",icon:Object(y.jsx)(ve.a,{}),onClick:()=>a(!0),className:"cel-button",children:"\u521b\u5efa\u5206\u4eab"})]}),Object(y.jsx)(S.a,{className:"cel-card",children:Object(y.jsx)(te.a,{columns:d,dataSource:r,rowKey:"id",loading:n,pagination:{pageSize:10,showSizeChanger:!1,showQuickJumper:!0}})}),Object(y.jsx)(ae.a,{title:"\u521b\u5efa\u6587\u4ef6\u5206\u4eab",open:t,onOk:()=>c.submit(),onCancel:()=>a(!1),confirmLoading:l.isLoading,width:600,children:Object(y.jsxs)(I.a,{form:c,layout:"vertical",onFinish:e=>{O.a.info("\u8bf7\u5148\u5728\u6587\u4ef6\u9875\u9762\u9009\u62e9\u8981\u5206\u4eab\u7684\u6587\u4ef6")},children:[Object(y.jsx)(I.a.Item,{children:Object(y.jsx)(ke,{type:"secondary",children:'\u8bf7\u524d\u5f80"\u6211\u7684\u6587\u4ef6"\u9875\u9762\uff0c\u70b9\u51fb\u6587\u4ef6\u64cd\u4f5c\u680f\u7684\u5206\u4eab\u6309\u94ae\u6765\u521b\u5efa\u5206\u4eab\u94fe\u63a5\u3002'})}),Object(y.jsx)(I.a.Item,{name:"password",label:"\u8bbf\u95ee\u5bc6\u7801\uff08\u53ef\u9009\uff09",children:Object(y.jsx)(T.a.Password,{placeholder:"\u7559\u7a7a\u8868\u793a\u65e0\u9700\u5bc6\u7801"})}),Object(y.jsx)(I.a.Item,{name:"expire_at",label:"\u8fc7\u671f\u65f6\u95f4\uff08\u53ef\u9009\uff09",children:Object(y.jsx)(oe.a,{showTime:!0,placeholder:"\u7559\u7a7a\u8868\u793a\u6c38\u4e0d\u8fc7\u671f",style:{width:"100%"}})}),Object(y.jsx)(I.a.Item,{name:"max_downloads",label:"\u6700\u5927\u4e0b\u8f7d\u6b21\u6570\uff08\u53ef\u9009\uff09",children:Object(y.jsx)(de.a,{placeholder:"\u7559\u7a7a\u8868\u793a\u65e0\u9650\u5236",style:{width:"100%"},min:1})})]})})]})},Se=a(246),Ie=a(313),Te=a(254);const{Title:ze,Text:Be}=k.a;var Re=()=>{const{shareCode:e}=Object(h.s)(),t=Object(h.q)(),[a,c]=Object(s.useState)(!0),[r,n]=Object(s.useState)(!1),[l,i]=Object(s.useState)(null),[o,d]=Object(s.useState)(""),[j,b]=Object(s.useState)(!1),[x,p]=Object(s.useState)("");Object(s.useEffect)(()=>{u()},[e]);const u=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{c(!0),p("");const a=await g.get("/api/files/share/".concat(e,"/"),{params:t?{password:t}:{}});i(a.data),b(!1)}catch(x){var a,s,r,n;if(403===(null===(a=x.response)||void 0===a?void 0:a.status)&&"\u9700\u8981\u5bc6\u7801"===(null===(s=x.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.error))b(!0);else if(404===(null===(n=x.response)||void 0===n?void 0:n.status))p("\u5206\u4eab\u94fe\u63a5\u4e0d\u5b58\u5728\u6216\u5df2\u8fc7\u671f");else{var l,o;p((null===(l=x.response)||void 0===l||null===(o=l.data)||void 0===o?void 0:o.error)||"\u83b7\u53d6\u5206\u4eab\u4fe1\u606f\u5931\u8d25")}}finally{c(!1)}},m=()=>{o.trim()?u(o):O.a.error("\u8bf7\u8f93\u5165\u5bc6\u7801")},f=e=>e?new Date(e).toLocaleString("zh-CN"):null;return a?Object(y.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:Object(y.jsx)(Se.a,{size:"large",tip:"\u52a0\u8f7d\u4e2d..."})}):x?Object(y.jsx)("div",{style:{maxWidth:600,margin:"50px auto"},children:Object(y.jsx)(_.a,{message:"\u8bbf\u95ee\u5931\u8d25",description:x,type:"error",showIcon:!0,action:Object(y.jsx)(C.a,{type:"primary",onClick:()=>t("/login"),children:"\u8fd4\u56de\u767b\u5f55"})})}):j&&!l?Object(y.jsx)("div",{style:{maxWidth:400,margin:"100px auto"},children:Object(y.jsxs)(S.a,{children:[Object(y.jsxs)(ze,{level:3,style:{textAlign:"center",marginBottom:30},children:[Object(y.jsx)(B.a,{})," \u8bbf\u95ee\u53d7\u4fdd\u62a4\u7684\u5206\u4eab"]}),Object(y.jsxs)(q.a,{direction:"vertical",style:{width:"100%"},children:[Object(y.jsx)(T.a.Password,{placeholder:"\u8bf7\u8f93\u5165\u8bbf\u95ee\u5bc6\u7801",value:o,onChange:e=>d(e.target.value),onPressEnter:m}),Object(y.jsx)(C.a,{type:"primary",block:!0,onClick:m,loading:a,children:"\u89e3\u9501\u8bbf\u95ee"})]})]})}):Object(y.jsx)("div",{style:{maxWidth:800,margin:"50px auto",padding:"0 20px"},children:Object(y.jsxs)(S.a,{children:[Object(y.jsxs)("div",{style:{textAlign:"center",marginBottom:30},children:[Object(y.jsx)(D.a,{style:{fontSize:64,color:"#1890ff",marginBottom:16}}),Object(y.jsx)(ze,{level:2,children:l.file_name})]}),Object(y.jsxs)(Ie.a,{column:1,bordered:!0,style:{marginBottom:30},children:[Object(y.jsx)(Ie.a.Item,{label:"\u6587\u4ef6\u5927\u5c0f",children:Object(y.jsx)(ee.a,{color:"blue",children:(e=>{if(!e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]})(l.file_size)})}),Object(y.jsx)(Ie.a.Item,{label:"\u4e0b\u8f7d\u6b21\u6570",children:Object(y.jsxs)(q.a,{children:[Object(y.jsx)(be.a,{}),Object(y.jsxs)(Be,{strong:!0,children:[l.download_count," / ",l.max_downloads||"\u65e0\u9650\u5236"]})]})}),l.expire_at&&Object(y.jsx)(Ie.a.Item,{label:"\u8fc7\u671f\u65f6\u95f4",children:Object(y.jsxs)(q.a,{children:[Object(y.jsx)(je.a,{}),Object(y.jsx)(Be,{type:new Date(l.expire_at)<new Date?"danger":"success",children:f(l.expire_at)})]})}),l.password_protected&&Object(y.jsx)(Ie.a.Item,{label:"\u8bbf\u95ee\u4fdd\u62a4",children:Object(y.jsxs)(ee.a,{color:"orange",children:[Object(y.jsx)(B.a,{})," \u5bc6\u7801\u4fdd\u62a4"]})}),Object(y.jsx)(Ie.a.Item,{label:"\u5206\u4eab\u65f6\u95f4",children:f(l.created_at)})]}),Object(y.jsx)("div",{style:{textAlign:"center"},children:Object(y.jsx)(C.a,{type:"primary",size:"large",icon:Object(y.jsx)(Te.a,{}),onClick:async()=>{try{n(!0);const t=await g.post("/api/files/share/".concat(e,"/download/"),j?{password:o}:{},{responseType:"blob"}),a=new Blob([t.data]),s=window.URL.createObjectURL(a),c=document.createElement("a");c.href=s;const r=t.headers["content-disposition"];let d=(null===l||void 0===l?void 0:l.file_name)||"download";if(r){const e=r.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);e&&e[1]&&(d=e[1].replace(/['"]/g,""))}c.download=d,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(s),O.a.success("\u6587\u4ef6\u4e0b\u8f7d\u6210\u529f\uff01"),l&&i(Object(V.a)(Object(V.a)({},l),{},{download_count:l.download_count+1}))}catch(x){var t,a;O.a.error((null===(t=x.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"\u4e0b\u8f7d\u5931\u8d25")}finally{n(!1)}},loading:r,disabled:l.max_downloads>0&&l.download_count>=l.max_downloads,children:l.max_downloads>0&&l.download_count>=l.max_downloads?"\u4e0b\u8f7d\u6b21\u6570\u5df2\u7528\u5b8c":"\u4e0b\u8f7d\u6587\u4ef6"})}),Object(y.jsx)("div",{style:{textAlign:"center",marginTop:20},children:Object(y.jsx)(C.a,{type:"link",onClick:()=>t("/login"),children:"\u8fd4\u56de\u767b\u5f55\u9875\u9762"})})]})})},Fe=a(317),Ne=a(331);const{Title:Le,Text:Me}=k.a;var Ee=()=>{const{user:e,updateProfile:t}=v(),[a]=I.a.useForm(),[r,n]=Object(s.useState)(!1),{data:l}=Object(i.useQuery)("storage-info",()=>g.get("/api/files/storage/").then(e=>e.data));c.a.useEffect(()=>{e&&a.setFieldsValue({username:e.username,email:e.email,first_name:e.first_name,last_name:e.last_name})},[e,a]);const o={name:"avatar",beforeUpload:e=>{if(!["image/jpeg","image/png","image/gif","image/webp"].includes(e.type))return O.a.error("\u53ea\u652f\u6301 JPG\u3001PNG\u3001GIF\u3001WebP \u683c\u5f0f\u7684\u56fe\u7247\uff01"),!1;return e.size/1024/1024<2?((async e=>{const t=new FormData;t.append("avatar",e);try{n(!0);const e=await g.post("/api/auth/upload-avatar/",t,{headers:{"Content-Type":void 0}});O.a.success("\u5934\u50cf\u4e0a\u4f20\u6210\u529f\uff01"),e.data.user&&window.location.reload()}catch(c){var a,s;O.a.error((null===(a=c.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.error)||"\u5934\u50cf\u4e0a\u4f20\u5931\u8d25\uff01")}finally{n(!1)}})(e),!1):(O.a.error("\u56fe\u7247\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7 2MB\uff01"),!1)},showUploadList:!1};return Object(y.jsxs)("div",{children:[Object(y.jsx)(Le,{level:2,style:{color:"#333",marginBottom:"24px"},children:"\u4e2a\u4eba\u8bbe\u7f6e"}),Object(y.jsxs)(P.a,{gutter:[24,24],children:[Object(y.jsx)(W.a,{xs:24,lg:8,children:Object(y.jsxs)(S.a,{className:"cel-card",title:"\u4e2a\u4eba\u4fe1\u606f",children:[Object(y.jsxs)("div",{style:{textAlign:"center",marginBottom:"24px"},children:[Object(y.jsx)(Fe.a,{size:120,src:null!==e&&void 0!==e&&e.avatar?"http://localhost:8000".concat(e.avatar):void 0,icon:Object(y.jsx)(z.a,{}),style:{marginBottom:"16px"}}),Object(y.jsx)("div",{children:Object(y.jsxs)(q.a,{children:[Object(y.jsx)(X.a,Object(V.a)(Object(V.a)({},o),{},{children:Object(y.jsx)(C.a,{icon:Object(y.jsx)(ne.a,{}),size:"small",className:"cel-button",loading:r,children:"\u66f4\u6362\u5934\u50cf"})})),(null===e||void 0===e?void 0:e.avatar)&&Object(y.jsx)(C.a,{size:"small",onClick:async()=>{try{n(!0),await g.delete("/api/auth/delete-avatar/"),O.a.success("\u5934\u50cf\u5220\u9664\u6210\u529f\uff01"),window.location.reload()}catch(a){var e,t;O.a.error((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"\u5934\u50cf\u5220\u9664\u5931\u8d25\uff01")}finally{n(!1)}},loading:r,children:"\u5220\u9664\u5934\u50cf"})]})})]}),Object(y.jsxs)(q.a,{direction:"vertical",style:{width:"100%"},children:[Object(y.jsxs)("div",{children:[Object(y.jsx)(Me,{type:"secondary",children:"\u7528\u6237\u540d"}),Object(y.jsx)("div",{style:{fontWeight:"bold"},children:null===e||void 0===e?void 0:e.username})]}),Object(y.jsxs)("div",{children:[Object(y.jsx)(Me,{type:"secondary",children:"\u6ce8\u518c\u65f6\u95f4"}),Object(y.jsx)("div",{children:null!==e&&void 0!==e&&e.date_joined?new Date(e.date_joined).toLocaleDateString():"-"})]})]})]})}),Object(y.jsx)(W.a,{xs:24,lg:16,children:Object(y.jsx)(S.a,{className:"cel-card",title:"\u7f16\u8f91\u8d44\u6599",children:Object(y.jsxs)(I.a,{form:a,layout:"vertical",onFinish:async e=>{n(!0);const a=await t(e);n(!1),a.success&&O.a.success("\u4e2a\u4eba\u8d44\u6599\u66f4\u65b0\u6210\u529f\uff01")},children:[Object(y.jsxs)(P.a,{gutter:16,children:[Object(y.jsx)(W.a,{xs:24,sm:12,children:Object(y.jsx)(I.a.Item,{name:"first_name",label:"\u540d\u5b57",children:Object(y.jsx)(T.a,{placeholder:"\u8bf7\u8f93\u5165\u540d\u5b57"})})}),Object(y.jsx)(W.a,{xs:24,sm:12,children:Object(y.jsx)(I.a.Item,{name:"last_name",label:"\u59d3\u6c0f",children:Object(y.jsx)(T.a,{placeholder:"\u8bf7\u8f93\u5165\u59d3\u6c0f"})})})]}),Object(y.jsx)(I.a.Item,{name:"email",label:"\u90ae\u7bb1\u5730\u5740",rules:[{type:"email",message:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u90ae\u7bb1\u5730\u5740"}],children:Object(y.jsx)(T.a,{placeholder:"\u8bf7\u8f93\u5165\u90ae\u7bb1\u5730\u5740"})}),Object(y.jsx)(I.a.Item,{children:Object(y.jsx)(C.a,{type:"primary",htmlType:"submit",loading:r,icon:Object(y.jsx)(Ne.a,{}),className:"cel-button",children:"\u4fdd\u5b58\u66f4\u6539"})})]})})})]}),Object(y.jsx)(P.a,{gutter:[24,24],style:{marginTop:"24px"},children:Object(y.jsx)(W.a,{span:24,children:Object(y.jsxs)(S.a,{className:"cel-card",title:"\u5b58\u50a8\u4fe1\u606f",children:[Object(y.jsxs)(P.a,{gutter:[24,24],children:[Object(y.jsx)(W.a,{xs:24,sm:8,children:Object(y.jsxs)("div",{style:{textAlign:"center"},children:[Object(y.jsx)(Le,{level:3,style:{color:"#667eea",margin:0},children:(null===l||void 0===l?void 0:l.storage_quota_display)||"0 B"}),Object(y.jsx)(Me,{type:"secondary",children:"\u5b58\u50a8\u914d\u989d"})]})}),Object(y.jsx)(W.a,{xs:24,sm:8,children:Object(y.jsxs)("div",{style:{textAlign:"center"},children:[Object(y.jsx)(Le,{level:3,style:{color:"#ff6b6b",margin:0},children:(null===l||void 0===l?void 0:l.used_storage_display)||"0 B"}),Object(y.jsx)(Me,{type:"secondary",children:"\u5df2\u4f7f\u7528"})]})}),Object(y.jsx)(W.a,{xs:24,sm:8,children:Object(y.jsxs)("div",{style:{textAlign:"center"},children:[Object(y.jsx)(Le,{level:3,style:{color:"#43e97b",margin:0},children:(null===l||void 0===l?void 0:l.available_storage_display)||"0 B"}),Object(y.jsx)(Me,{type:"secondary",children:"\u53ef\u7528\u7a7a\u95f4"})]})})]}),Object(y.jsxs)("div",{style:{marginTop:"24px"},children:[Object(y.jsx)(Me,{strong:!0,children:"\u5b58\u50a8\u4f7f\u7528\u7387"}),Object(y.jsx)(U.a,{percent:(null===l||void 0===l?void 0:l.storage_usage_percentage)||0,strokeColor:{"0%":"#667eea","100%":"#764ba2"},format:e=>"".concat(null===e||void 0===e?void 0:e.toFixed(1),"%")})]})]})})})]})},Ae=a(201),Pe=a(332);const{Sider:We}=p.a;var Qe=()=>{const e=Object(h.q)(),t=Object(h.o)(),a=[{key:"/dashboard",icon:Object(y.jsx)(Pe.a,{}),label:"\u4eea\u8868\u76d8"},{key:"/files",icon:Object(y.jsx)(H.a,{}),label:"\u6211\u7684\u6587\u4ef6"},{key:"/shares",icon:Object(y.jsx)(Y.a,{}),label:"\u6211\u7684\u5206\u4eab"},{key:"/profile",icon:Object(y.jsx)(z.a,{}),label:"\u4e2a\u4eba\u8bbe\u7f6e"}];return Object(y.jsxs)(We,{width:240,style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",borderRight:"1px solid rgba(255, 255, 255, 0.2)"},children:[Object(y.jsx)("div",{style:{height:"64px",display:"flex",alignItems:"center",justifyContent:"center",borderBottom:"1px solid rgba(255, 255, 255, 0.2)"},children:Object(y.jsx)("div",{style:{width:"50px",height:"50px",background:"linear-gradient(145deg, #667eea, #764ba2)",borderRadius:"15px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"24px",fontWeight:"bold"},children:"\u2601"})}),Object(y.jsx)(Ae.a,{mode:"inline",selectedKeys:[(()=>{const e=t.pathname;return e.startsWith("/files")?"/files":e})()],items:a,onClick:t=>{let{key:a}=t;e(a)},style:{border:"none",background:"transparent",fontSize:"16px"}})]})},qe=a(204),Ue=a(333),De=a(334);const{Header:He}=p.a,{Text:Ye}=k.a;var Ke=()=>{const{user:e,logout:t}=v(),a=[{key:"profile",icon:Object(y.jsx)(Ue.a,{}),label:"\u4e2a\u4eba\u8bbe\u7f6e",onClick:()=>window.location.href="/profile"},{type:"divider"},{key:"logout",icon:Object(y.jsx)(De.a,{}),label:"\u9000\u51fa\u767b\u5f55",onClick:t}];return Object(y.jsxs)(He,{style:{padding:"0 24px",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Object(y.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(y.jsx)("div",{style:{width:"40px",height:"40px",background:"linear-gradient(145deg, #ff6b6b, #ff8e53)",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"20px",fontWeight:"bold",marginRight:"12px"},children:"\u2601"}),Object(y.jsx)(Ye,{style:{fontSize:"20px",fontWeight:"bold",color:"#333"},children:"\u4e91\u76d8\u7cfb\u7edf"})]}),Object(y.jsx)(qe.a,{menu:{items:a},placement:"bottomRight",children:Object(y.jsxs)("div",{style:{display:"flex",alignItems:"center",cursor:"pointer",padding:"8px 12px",borderRadius:"20px",transition:"background 0.3s ease"},onMouseEnter:e=>e.currentTarget.style.background="rgba(0,0,0,0.05)",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:[Object(y.jsx)(Fe.a,{src:null===e||void 0===e?void 0:e.avatar,icon:Object(y.jsx)(z.a,{}),size:"small",style:{marginRight:"8px"}}),Object(y.jsx)(q.a,{children:Object(y.jsx)(Ye,{strong:!0,children:null===e||void 0===e?void 0:e.username})})]})})]})};const{Content:Ge}=p.a;var Je=function(){const{user:e,loading:t}=v();return t?Object(y.jsx)("div",{className:"loading-container",children:Object(y.jsx)("div",{className:"loading-spinner",children:Object(y.jsx)(u.a,{})})}):e?Object(y.jsxs)(p.a,{style:{minHeight:"100vh"},children:[Object(y.jsx)(Qe,{}),Object(y.jsxs)(p.a,{children:[Object(y.jsx)(Ke,{}),Object(y.jsx)(Ge,{style:{margin:"24px 16px",padding:"24px",background:"transparent"},children:Object(y.jsxs)(h.d,{children:[Object(y.jsx)(h.b,{path:"/",element:Object(y.jsx)(h.a,{to:"/dashboard",replace:!0})}),Object(y.jsx)(h.b,{path:"/dashboard",element:Object(y.jsx)(J,{})}),Object(y.jsx)(h.b,{path:"/files",element:Object(y.jsx)(ye,{})}),Object(y.jsx)(h.b,{path:"/files/:folderId",element:Object(y.jsx)(ye,{})}),Object(y.jsx)(h.b,{path:"/shares",element:Object(y.jsx)(Ce,{})}),Object(y.jsx)(h.b,{path:"/profile",element:Object(y.jsx)(Ee,{})}),Object(y.jsx)(h.b,{path:"/share/:shareCode",element:Object(y.jsx)(Re,{})}),Object(y.jsx)(h.b,{path:"*",element:Object(y.jsx)(h.a,{to:"/dashboard",replace:!0})})]})})]})]}):Object(y.jsxs)(h.d,{children:[Object(y.jsx)(h.b,{path:"/login",element:Object(y.jsx)(N,{})}),Object(y.jsx)(h.b,{path:"/register",element:Object(y.jsx)(A,{})}),Object(y.jsx)(h.b,{path:"/share/:shareCode",element:Object(y.jsx)(Re,{})}),Object(y.jsx)(h.b,{path:"*",element:Object(y.jsx)(h.a,{to:"/login",replace:!0})})]})};a(275);x.a.locale("zh-cn");const Ve=new i.QueryClient;n.a.createRoot(document.getElementById("root")).render(Object(y.jsx)(c.a.StrictMode,{children:Object(y.jsx)(i.QueryClientProvider,{client:Ve,children:Object(y.jsx)(o.a,{locale:j.a,children:Object(y.jsx)(l.a,{children:Object(y.jsx)(w,{children:Object(y.jsx)(Je,{})})})})})}))}},[[285,1,2]]]);
//# sourceMappingURL=main.32c6f19b.chunk.js.map