# 头像功能说明

## 功能概述

云存储系统现已支持用户头像上传、更换和删除功能。

## 后端API

### 1. 上传头像
- **接口**: `POST /api/auth/upload-avatar/`
- **认证**: Token认证
- **参数**: 
  - `avatar` (文件): 图片文件
- **限制**:
  - 文件大小: 最大2MB
  - 支持格式: JPG、PNG、GIF、WebP
- **响应**: 
  ```json
  {
    "message": "头像上传成功",
    "user": { ... }
  }
  ```

### 2. 删除头像
- **接口**: `DELETE /api/auth/delete-avatar/`
- **认证**: Token认证
- **响应**:
  ```json
  {
    "message": "头像删除成功",
    "user": { ... }
  }
  ```

### 3. 获取用户信息
- **接口**: `GET /api/auth/profile/`
- **认证**: Token认证
- **响应**: 包含头像URL字段

## 前端功能

### 1. 个人资料页面 (`/profile`)
- 显示当前头像（如无则显示默认图标）
- "更换头像" 按钮：点击选择图片文件
- "删除头像" 按钮：仅在已设置头像时显示

### 2. 功能特性
- 支持拖拽上传
- 文件类型验证
- 文件大小验证
- 上传进度显示
- 实时预览

## 使用方法

### 1. 访问个人资料页面
登录后点击导航栏的用户名或头像，进入个人资料页面。

### 2. 上传头像
1. 点击"更换头像"按钮
2. 选择图片文件（支持JPG、PNG、GIF、WebP格式）
3. 系统自动上传并显示新头像

### 3. 删除头像
1. 在个人资料页面
2. 点击"删除头像"按钮
3. 确认删除后恢复默认头像

## 技术实现

### 后端
- Django REST Framework
- ImageField 存储头像
- MultiPartParser 处理文件上传
- 文件验证和大小限制

### 前端
- React + Ant Design
- Upload 组件处理文件选择
- API 调用上传/删除头像
- 实时更新用户信息

## 存储位置
- 头像文件存储在: `media/avatars/` 目录
- 访问URL: `http://localhost:8000/media/avatars/文件名`

## 测试方法
运行测试脚本验证功能：
```bash
python scripts/test_avatar.py
```

## 注意事项
1. 上传新头像时会自动删除旧头像
2. 头像文件大小限制为2MB
3. 仅支持常见的图片格式
4. 需要登录后才能使用头像功能